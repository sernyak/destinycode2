<!DOCTYPE html><html lang="uk"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">    <title>Destiny Code - –¢–≤—ñ–π AI-–ê—Å—Ç—Ä–æ–ª–æ–≥</title>        <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è Tailwind CSS -->    <script src="https://cdn.tailwindcss.com"></script>        <!-- –®—Ä–∏—Ñ—Ç Montserrat -->    <link rel="preconnect" href="https://fonts.googleapis.com">    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">            <!-- –®—Ä–∏—Ñ—Ç Playfair Display –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤ PDF -->    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&display=swap" rel="stylesheet">            <!-- ================================================================= -->    <!-- üî• BULLETPROOF ASTRO LOADER (–ó–ú–Ü–ù–ï–ù–û: –ü–æ—Ç—Ä—ñ–π–Ω–∏–π –∑–∞—Ö–∏—Å—Ç) üî• -->    <!-- ================================================================= -->    <script>        // 1. –ì–æ—Ç—É—î–º–æ “ë—Ä—É–Ω—Ç –¥–ª—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏        window.module = { exports: {} };        window.exports = window.module.exports;        window.isAstroLibReady = false;        // 2. –°–ø–∏—Å–æ–∫ –¥–∂–µ—Ä–µ–ª (–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç: Unpkg -> JSDelivr -> –õ–æ–∫–∞–ª—å–Ω–∏–π)        const astroSources = [            "https://unpkg.com/circular-natal-horoscope-js@1.1.0/dist/index.js",      // –î–∂–µ—Ä–µ–ª–æ 1 (–®–≤–∏–¥–∫–µ)            "https://cdn.jsdelivr.net/npm/circular-natal-horoscope-js@1.1.0/dist/index.js", // –î–∂–µ—Ä–µ–ª–æ 2 (–ù–∞–¥—ñ–π–Ω–µ)            "./js/astro-lib.js"                                                        // –î–∂–µ—Ä–µ–ª–æ 3 (–¢–≤—ñ–π –•–æ—Å—Ç–∏–Ω–≥)        ];        function onAstroLibSuccess() {            if (window.module && window.module.exports && window.module.exports.Horoscope) {                window.CircularNatalHoroscope = window.module.exports;                window.isAstroLibReady = true;                console.log("‚úÖ Astro Library Loaded Successfully!");                                // –Ø–∫—â–æ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –≤–∂–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞, —Å–ø—Ä–æ–±—É—î–º–æ –æ–Ω–æ–≤–∏—Ç–∏ –¥–∞–Ω—ñ                if (typeof renderPlanetaryFingerprint === 'function') {                    renderPlanetaryFingerprint();                }            } else {                console.error("‚ùå Library loaded but exports are missing.");            }        }        function loadAstroLib(index = 0) {            if (index >= astroSources.length) {                console.error("‚ùå CRITICAL: –í—Å—ñ –¥–∂–µ—Ä–µ–ª–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ (CDN —Ç–∞ –õ–æ–∫–∞–ª—å–Ω–µ) –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ.");                return;            }            const src = astroSources[index];            console.log(`‚è≥ Trying to load Astro Lib from: ${src}`);            const script = document.createElement('script');            script.src = src;            script.async = true;            script.onload = () => {                onAstroLibSuccess();            };            script.onerror = () => {                console.warn(`‚ö†Ô∏è Failed to load from ${src}. Switching to backup source...`);                loadAstroLib(index + 1); // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –ø—Ä–æ–±—É—î–º–æ –Ω–∞—Å—Ç—É–ø–Ω–µ –¥–∂–µ—Ä–µ–ª–æ            };            document.head.appendChild(script);        }        // –°—Ç–∞—Ä—Ç –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è        loadAstroLib();    </script>    <!-- ================================================================= -->    <style>        /* --- –ë–∞–∑–æ–≤—ñ –ó–º—ñ–Ω–Ω—ñ --- */        :root {            --bg-color: #121212;            --primary-text-color: #e0e0e0;            --secondary-text-color: #a0a0a0;            --accent-color: #cda45e; /* –ó–æ–ª–æ—Ç–∏–π –∞–∫—Ü–µ–Ω—Ç */            --card-bg-color: #1a1a1a;            --border-color: #333333;            --error-color: #ef4444; /* red-500 */        }        body {            font-family: 'Montserrat', sans-serif;            background-color: var(--bg-color);            color: var(--primary-text-color);            -webkit-user-select: none; /* Safari */            -ms-user-select: none; /* IE 10+ */            user-select: none; /* Standard */            -webkit-tap-highlight-color: transparent;         }        /* --- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –í–æ—Ä–æ–Ω–∫–∏ (–í–ò–ü–†–ê–í–õ–ï–ù–û –°–¢–†–ò–ë–ö–ò) --- */        .funnel-container {            max-width: 480px; /* –¢—Ä–æ—Ö–∏ —à–∏—Ä—à–µ –¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç—É */            margin: 0 auto;   /* –¶–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—ñ */            display: flex;            flex-direction: column;            min-height: 100vh;             justify-content: flex-start; /* üî• FIX: flex-start –∑–∞–º—ñ—Å—Ç—å center, —â–æ–± –Ω–µ —Å—Ç—Ä–∏–±–∞–ª–æ –ø—Ä–∏ —Å–∫—Ä–æ–ª—ñ */            padding-top: 40px;           /* –í—ñ–¥—Å—Ç—É–ø –∑–≤–µ—Ä—Ö—É –¥–ª—è –±–∞–ª–∞–Ω—Å—É */            padding-bottom: 40px;        /* –í—ñ–¥—Å—Ç—É–ø –∑–Ω–∏–∑—É */            position: relative;        }        .funnel-step {            display: none; /* –í—Å—ñ –∫—Ä–æ–∫–∏ —Å—Ö–æ–≤–∞–Ω—ñ */            animation: fadeIn 0.5s ease-out; /* –ü–ª–∞–≤–Ω–∞ –ø–æ—è–≤–∞ */            /* –í–∏–¥–∞–ª–µ–Ω–æ auto margins, —è–∫—ñ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—É–≤–∞–ª–∏ –∑—ñ —Å–∫—Ä–æ–ª–æ–º */            padding-bottom: 20px;        }        .funnel-step.active {            display: block; /* –ê–∫—Ç–∏–≤–Ω–∏–π –∫—Ä–æ–∫ –≤–∏–¥–∏–º–∏–π */        }                /* –°–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π –≤—ñ–¥—Å—Ç—É–ø –¥–ª—è Paywall, —â–æ–± –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ —Ö–æ–≤–∞–≤—Å—è –∑–∞ Sticky Button */        #final-paywall-step {            padding-bottom: 140px;         }        @keyframes fadeIn {            from { opacity: 0; transform: translateY(10px); }            to { opacity: 1; transform: translateY(0); }        }        /* --- –°—Ç–∏–ª—ñ –ï–ª–µ–º–µ–Ω—Ç—ñ–≤ --- */        .input-field {            position: relative;            color: var(--primary-text-color);            padding: 1rem;            border: 1px solid var(--border-color);            background-color: var(--card-bg-color);            border-radius: 0.5rem; /* rounded-lg */            width: 100%;            font-size: 1rem;            font-family: 'Montserrat', sans-serif;            transition: border-color 0.2s ease, box-shadow 0.2s ease;        }        .input-field:focus {            outline: none;            box-shadow: 0 0 0 2px var(--accent-color);            border-color: var(--accent-color);        }        .input-field.input-error {            border-color: var(--error-color);            box-shadow: 0 0 0 2px var(--error-color);        }        .error-text {            color: var(--error-color);            font-size: 0.875rem; /* text-sm */            text-align: left;            display: none; /* –°—Ö–æ–≤–∞–Ω–æ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º */            margin-top: 0.5rem; /* mt-2 */        }                .info-text {            color: var(--accent-color);            font-size: 0.875rem; /* text-sm */            text-align: center;            display: none;             margin-top: 0.5rem; /* mt-2 */        }        input[type="date"]::-webkit-calendar-picker-indicator,        input[type="time"]::-webkit-calendar-picker-indicator {            filter: invert(80%) sepia(30%) saturate(5000%) hue-rotate(350deg) brightness(1.1);            cursor: pointer;            opacity: 0.9;            font-size: 1.25rem;            transition: opacity 0.2s;        }        input[type="date"]::-webkit-calendar-picker-indicator:hover,        input[type="time"]::-webkit-calendar-picker-indicator:hover {            opacity: 1;        }        /* --- –°—Ç–∏–ª—ñ –ö–Ω–æ–ø–æ–∫ --- */        .btn {            width: 100%;            font-weight: 700;            border-radius: 0.5rem;            padding: 1rem;            font-size: 1rem;            transition: all 0.3s ease;            cursor: pointer;            position: relative;            display: flex;            align-items: center;            justify-content: center;        }                .btn:disabled {            opacity: 0.5;            cursor: not-allowed;        }                .btn-spinner {            display: none;             width: 1.25rem;             height: 1.25rem;            border-width: 2px;            border-style: solid;            border-radius: 9999px;            animation: spin 1s linear infinite;            border-color: transparent;            border-top-color: currentColor;         }                .btn.loading .btn-text {            opacity: 0.5;         }        .btn.loading .btn-spinner {            display: block;            position: absolute;        }        .btn-primary {            background-color: var(--accent-color);            color: var(--bg-color);            box-shadow: 0 4px 15px -5px rgba(205, 164, 94, 0.4);         }                .btn-primary:not(:disabled):hover {            opacity: 0.9;            box-shadow: 0 6px 20px -5px rgba(205, 164, 94, 0.5);            transform: translateY(-2px);        }        .btn-skip {            background: none;            border: none;            color: var(--secondary-text-color);            font-size: 0.9rem;            font-weight: 500;        }        .btn-skip:hover {            color: var(--primary-text-color);        }        .btn-secondary {            background-color: var(--card-bg-color);            color: var(--accent-color);            border: 1px solid var(--accent-color);            opacity: 0.8;        }                .btn-secondary:not(:disabled):hover {            opacity: 1;            background-color: rgba(205, 164, 94, 0.05);         }        /* --- v2.15: –û–ù–û–í–õ–ï–ù–Ü –°—Ç–∏–ª—ñ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è (–ö—Ä–æ–∫ 2) --- */        #loading-typing-container {            font-size: 1.25rem;             color: var(--secondary-text-color);            margin-top: 1rem;            min-height: 2.5rem;             text-align: center;        }                .typing-cursor {            display: inline-block;             width: 10px;            height: 1.25rem;            background-color: var(--accent-color);            animation: blink 0.7s infinite;            margin-left: 5px;            vertical-align: middle;        }                @keyframes blink {            0%, 100% { opacity: 1; }            50% { opacity: 0; }        }        .spinner { /* –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –Ω–∞ –ö—Ä–æ—Ü—ñ 2 —Ç–∞ 7 */            width: 4rem;             height: 4rem;            border-width: 4px;            border-style: dashed;             border-radius: 9999px;             animation: spin 1.5s linear infinite;            margin: 2rem auto;            border-color: var(--accent-color) transparent var(--accent-color) transparent;        }        @keyframes spin {            to { transform: rotate(360deg); }        }        /* === v2.17.7: –û–ù–û–í–õ–ï–ù–Ü –°—Ç–∏–ª—ñ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è (–ö—Ä–æ–∫ 7) === */        #report-typing-container {            font-size: 1.25rem;             color: var(--secondary-text-color);            margin-top: 1.5rem;            height: 4rem;             display: flex;            align-items: center;            justify-content: center;        }        /* --- –°—Ç–∏–ª—ñ Paywall --- */        .paywall-item {            display: flex;            align-items: center;            background-color: var(--card-bg-color);            border: 1px solid var(--border-color);            border-radius: 0.5rem;            padding: 1rem;            opacity: 0.7;         }        .paywall-icon {            color: var(--accent-color);            font-size: 1.25rem;            margin-right: 0.75rem;        }        /* --- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ --- */        .modal-overlay {            position: fixed;            top: 0;            left: 0;            width: 100%;            height: 100%;            background-color: rgba(0, 0, 0, 0.8);            display: none;             justify-content: center;            align-items: center;            z-index: 100;            animation: fadeIn 0.3s ease-out;        }        .modal-content {            background-color: var(--card-bg-color);            border: 1px solid var(--border-color);            border-top: 4px solid var(--accent-color);            border-radius: 0.5rem;            padding: 2rem;            max-width: 90%;            width: 400px;            text-align: center;            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);        }        .modal-btn-close {            margin-top: 1.5rem;            background-color: #4b5563;             color: white;            border: 1px solid #4b5563;        }                .modal-btn-close:hover {            background-color: #6b7280;             border-color: #6b7280;        }        /* --- LTV –ê–ø—Å–µ–ª (–ö—Ä–æ–∫ 7) --- */        .ltv-upsell-box {            background-color: var(--card-bg-color);            border: 1px solid var(--accent-color);            border-radius: 0.5rem;            padding: 1rem;            margin-top: 1.5rem;            box-shadow: 0 0 25px rgba(205, 164, 94, 0.1), 0 4px 10px rgba(0,0,0,0.2);        }        /* --- –î–∏–Ω–∞–º—ñ—á–Ω–∏–π –ó–≤—ñ—Ç (–ö—Ä–æ–∫ 7) --- */        .report-section { }                .report-advice {            background-color: var(--bg-color);             border: 1px solid var(--border-color);            border-left: 3px solid var(--accent-color);             margin-top: 1rem;            padding: 1rem;            border-radius: 0.25rem 0.5rem 0.5rem 0.25rem;        }                /* --- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫ PDF/Share (–ö—Ä–æ–∫ 7) --- */        #report-actions-container {            margin-top: 2rem;            padding-top: 1.5rem;            border-top: 1px solid var(--border-color);            display: flex;            flex-direction: column;            gap: 0.75rem;         }                /* === FIX FOR SVG RENDERING (OFF-SCREEN) === */        #chart-hidden-render {            position: absolute;            top: -9999px;            left: -9999px;            width: 600px;            height: 600px;            display: block;             z-index: -9999;            background: transparent;        }        /* === –°–¢–ò–õ–Ü –î–õ–Ø –ë–õ–û–ö–£ –ü–ï–†–ï–í–Ü–†–ö–ò –î–ê–ù–ò–• (STEP 5 & 7) === */        /* === UPDATED v2.34: SUPER COMPACT MODE (–ó–∞–ø–∏—Ç –Ω–∞ –∑–º–µ–Ω—à–µ–Ω–Ω—è –≤–∏—Å–æ—Ç–∏) === */        .astro-data-box {            margin-top: 1rem;            margin-bottom: 1.5rem;            padding: 0.75rem; /* Compact padding */            background-color: rgba(205, 164, 94, 0.05);            border: 1px dashed rgba(205, 164, 94, 0.3);            border-radius: 8px;            text-align: left;        }        .astro-data-title {            color: var(--accent-color);            font-size: 0.7rem; /* Smaller title */            text-transform: uppercase;            letter-spacing: 1px;            margin-bottom: 0.5rem;            font-weight: 700;            text-align: center;            border-bottom: 1px solid rgba(205, 164, 94, 0.2);            padding-bottom: 0.25rem;        }        .astro-data-grid {            display: grid;            grid-template-columns: 1fr 1fr;            gap: 0.5rem 0.25rem; /* Very small gap */        }                /* Element Container */        .astro-data-item {            display: flex;            flex-direction: column;             justify-content: flex-start;            padding-left: 5px;        }        /* Row 1: Planet + Sign */        .astro-label-row {            font-size: 0.8rem; /* Compact font */            line-height: 1.1;            white-space: nowrap;             overflow: hidden;            text-overflow: ellipsis;             margin-bottom: 1px;        }                .astro-planet-name {            color: #ffffff;            font-weight: 700;            margin-right: 3px;        }                .astro-sign-name {            color: #9ca3af; /* Grey technical */            font-weight: 400;            font-family: monospace;             font-size: 0.75rem;        }        /* Row 2: Coordinates */        .astro-coords-row {            color: #6b7280;             font-family: monospace;             font-size: 0.65rem;             letter-spacing: 0px;        }                /* Chart Preview in Astro Box - Smaller */        .astro-chart-preview {            width: 140px;               height: 140px;            margin: 0 auto 8px auto;            position: relative;        }        .astro-chart-preview svg {            width: 100%;            height: 100%;        }                /* Pulse Animation */        .pulse-text {            animation: pulse 1.5s infinite;        }        @keyframes pulse {            0% { opacity: 0.5; }            50% { opacity: 1; }            100% { opacity: 0.5; }        }        /* === NEW: Sticky Paywall Button Styles === */        .sticky-paywall-footer {            position: fixed;            bottom: 0;            left: 0;            width: 100%;            /* üî• FIX: –ó–º–µ–Ω—à–µ–Ω–æ –ø–∞–¥–¥—ñ–Ω–≥ –∑ –±–æ–∫—ñ–≤ –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö, —â–æ–± –∫–Ω–æ–ø–∫–∞ –º–∞–ª–∞ –±—ñ–ª—å—à–µ –º—ñ—Å—Ü—è */            padding: 1rem 0.25rem 1.5rem 0.25rem; /* Even smaller side padding */            background: linear-gradient(to top, #121212 90%, rgba(18, 18, 18, 0) 100%);            /* Glassmorphism background for the button container */            backdrop-filter: blur(8px);            z-index: 50;            display: flex;            flex-direction: column;            align-items: center;            border-top: 1px solid rgba(255, 255, 255, 0.05);        }        /* Pulse glow for the main CTA */        .btn-pulse-glow {            animation: btn-glow 2s infinite;        }                @keyframes btn-glow {            0% { box-shadow: 0 0 0 0 rgba(205, 164, 94, 0.7); }            70% { box-shadow: 0 0 0 10px rgba(205, 164, 94, 0); }            100% { box-shadow: 0 0 0 0 rgba(205, 164, 94, 0); }        }    </style></head><!-- üî• FIX: –í–∏–¥–∞–ª–µ–Ω–æ 'flex items-center justify-center', —â–æ –≤–∏–∫–ª–∏–∫–∞–ª–æ —Å—Ç—Ä–∏–±–∫–∏ –ø—Ä–∏ —Å–∫—Ä–æ–ª—ñ.      –¢–µ–ø–µ—Ä body –ø–æ–≤–æ–¥–∏—Ç—å—Å—è —è–∫ –∑–≤–∏—á–∞–π–Ω–∏–π –±–ª–æ–∫–æ–≤–∏–π –µ–ª–µ–º–µ–Ω—Ç, —â–æ —Å—Ç–∞–±—ñ–ª—å–Ω—ñ—à–µ –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö. --><body class="antialiased min-h-screen bg-[#121212] p-4">    <!-- –ì–æ–ª–æ–≤–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–æ—Ä–æ–Ω–∫–∏ -->    <main class="funnel-container">                <!-- ====================================================== -->        <!-- –ö–†–û–ö 1: –õ–ï–ù–î–Ü–ù–ì (–ó–±—ñ—Ä –¥–∞—Ç–∏ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è) -->        <!-- ====================================================== -->        <section id="landing-step" class="funnel-step active space-y-8 text-center" style="margin-top: auto; margin-bottom: auto;">                        <div>                <svg class="w-16 h-16 mx-auto" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" style="color: var(--accent-color);">                    <circle cx="32" cy="32" r="2.5" fill="currentColor"/>                    <path d="M52 32C52 43.0457 43.0457 52 32 52C20.9543 52 12 43.0457 12 32C12 20.9543 20.9543 12 32 12C43.0457 12 52 20.9543 52 32Z" stroke="currentColor" stroke-width="2.5" stroke-opacity="0.3"/>                    <path d="M46.8564 32C46.8564 39.098 40.098 44.8564 32 44.8564C23.902 44.8564 17.1436 39.098 17.1436 32C17.1436 24.902 23.902 19.1436 32 19.1436C40.098 19.1436 46.8564 24.902 46.8564 32Z" stroke="currentColor" stroke-width="2.5"/>                </svg>            </div>                        <div class="space-y-4">                <h2 class="text-3xl font-bold text-white tracking-tight">                    –ü—Ä–∏—Ö–æ–≤–∞–Ω—ñ –ø–æ–¥—Ä–æ–±–∏—Ü—ñ —Ç–≤–æ—î—ó –æ—Å–æ–±–∏—Å—Ç–æ—Å—Ç—ñ üòà                </h2>                <p class="text-lg" style="color: var(--secondary-text-color);">                    –û–±–µ—Ä–∏ –¥–∞—Ç—É –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è, —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è, –Ω–∞ —Å–∫—ñ–ª—å–∫–∏ —Ç–∏ –∞—Ö—É—î–Ω–Ω–∞ üòá                </p>            </div>            <form id="birth-form" class="w-full space-y-4">                <div class="input-field h-14 flex items-center justify-center relative">                    <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2" style="color: var(--secondary-text-color);" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>                    </svg>                    <span id="date-placeholder" style="color: var(--secondary-text-color);">–û–±—Ä–∞—Ç–∏ –¥–∞—Ç—É</span>                    <input type="date" id="birth-date" name="birth-date" class="absolute top-0 left-0 w-full h-full opacity-0 cursor-pointer" required>                 </div>                <p id="error-message" class="error-text">                    –ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä–∏ –¥–∞—Ç—É –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è.                </p>                                <button type="submit" class="btn btn-primary !text-lg h-14">                    <span class="btn-text">–î—ñ–∑–Ω–∞—Ç–∏—Å—è –Ω–µ–≥–∞–π–Ω–æ</span>                    <span class="btn-spinner"></span>                </button>            </form>        </section>        <!-- ====================================================== -->        <!-- –ö–†–û–ö 2: –ï–ö–†–ê–ù –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø (–ê–Ω—ñ–º–∞—Ü—ñ—è –Ω–∞–±–æ—Ä—É —Ç–µ–∫—Å—Ç—É) -->        <!-- ====================================================== -->        <section id="loading-step" class="funnel-step text-center space-y-6" style="margin-top: auto; margin-bottom: auto;">            <div class="spinner"></div>            <div id="loading-typing-container" class="typing-container">                <span id="loading-text"></span><span id="loading-cursor" class="typing-cursor" style="display: none;"></span>            </div>        </section>        <!-- ====================================================== -->        <!-- –ö–†–û–ö 3: –†–ï–ó–£–õ–¨–¢–ê–¢ (–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ "–Ø–¥—Ä–æ") -->        <!-- ====================================================== -->        <section id="result-step" class="funnel-step space-y-6" style="margin-top: auto; margin-bottom: auto;">            <h2 class="text-2xl font-bold text-center text-white" id="result-title">–ê–Ω–∞–ª—ñ–∑ —Ç–≤–æ—î—ó –æ—Å–æ–±–∏—Å—Ç–æ—Å—Ç—ñ</h2>                        <div class="p-5 rounded-lg space-y-3" style="background-color: var(--card-bg-color); border: 1px solid var(--border-color);">                <h3 class="text-xl font-bold" style="color: var(--accent-color);" id="free-report-title">                    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–µ–ø–µ—Ä –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è –∑ –ø—Ä–æ–º–ø—Ç—É v2.17 -->                </h3>                                <div id="free-report-text" class="text-left leading-relaxed space-y-4" style="color: var(--secondary-text-color);">                    <i>(–¢—É—Ç –∑'—è–≤–∏—Ç—å—Å—è —Ç–≤—ñ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑...)</i>                </div>            </div>            <p class="text-center px-4" style="color: var(--secondary-text-color); margin-top: 1.5rem; margin-bottom: 0.5rem; font-size: 0.95rem; line-height: 1.6;" id="free-report-hook">                <!-- –•—É–∫ —Ç–µ–ø–µ—Ä –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è –∑ –ø—Ä–æ–º–ø—Ç—É v2.17 -->            </p>                        <div class="pt-4">                <button id="upgrade-button" class="btn btn-primary !text-lg !py-4">                    <span class="btn-text">–û—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ–≤–Ω–∏–π –∞–Ω–∞–ª—ñ–∑</span>                    <span class="btn-spinner"></span>                </button>            </div>        </section>                <!-- ====================================================== -->        <!-- –ö–†–û–ö 4: –ó–ë–Ü–† –ß–ê–°–£ –¢–ê –ú–Ü–°–¶–Ø (–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ) -->        <!-- ====================================================== -->        <section id="premium-data-step" class="funnel-step space-y-6 text-center" style="margin-top: auto; margin-bottom: auto;">             <h2 class="text-3xl font-bold text-white tracking-tight">                –†–æ–∑–±–ª–æ–∫—É–π "–ó–æ–ª–æ—Ç—É –¢—Ä—ñ–π–∫—É"            </h2>            <p class="text-lg" style="color: var(--secondary-text-color);">                –¢–≤—ñ–π –∞–Ω–∞–ª—ñ–∑ –°–æ–Ω—Ü—è - —Ü–µ –ª–∏—à–µ 1/3 —Ç–≤–æ–≥–æ —è–¥—Ä–∞. –í–≤–µ–¥–∏ —á–∞—Å —Ç–∞ –º—ñ—Å—Ç–æ, —â–æ–± —Ä–æ–∑–∫—Ä–∏—Ç–∏ —Å–≤—ñ–π <strong>–ê—Å—Ü–µ–Ω–¥–µ–Ω—Ç</strong> (—Ç–≤–æ—è –º–∞—Å–∫–∞) —Ç–∞ <strong>–ú—ñ—Å—è—Ü—å</strong> (—Ç–≤–æ—ó –µ–º–æ—Ü—ñ—ó).            </p>                        <div id="premium-form-container" class="w-full space-y-4">                <div>                    <label for="birth-time" class="block text-sm font-medium text-left mb-2" style="color: var(--secondary-text-color);">–¢–æ—á–Ω–∏–π —á–∞—Å –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ):</label>                    <div class="input-field h-14 flex items-center justify-center relative">                        <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2" style="color: var(--secondary-text-color);" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>                        </svg>                        <span id="time-placeholder" style="color: var(--secondary-text-color);">–û–±–µ—Ä–∏ —á–∞—Å</span>                        <input type="time" id="birth-time" name="birth-time" class="absolute top-0 left-0 w-full h-full opacity-0 cursor-pointer">                    </div>                </div>                <div>                    <label for="birth-city" class="block text-sm font-medium text-left mb-2" style="color: var(--secondary-text-color);">–ú—ñ—Å—Ç–æ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ):</label>                    <input type="text" id="birth-city" name="birth-city" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –ö–∏—ó–≤" class="input-field text-center">                                        <p id="city-error-message" class="error-text">                        –¢–µ–∫—Å—Ç –ø–æ–º–∏–ª–∫–∏...                    </p>                    <p id="city-info-message" class="info-text">                        <!-- –°—é–¥–∏ –±—É–¥–µ –≤—Å—Ç–∞–≤–ª–µ–Ω–æ —Ç–µ–∫—Å—Ç "–ú–∏ —É—Ç–æ—á–Ω–∏–ª–∏: –£–∂–≥–æ—Ä–æ–¥" -->                    </p>                </div>                <div class="pt-4 space-y-3">                    <button type="button" id="continue-to-paywall-button" class="btn btn-primary !text-lg !py-4">                        <span class="btn-text">–û—Ç—Ä–∏–º–∞—Ç–∏ –¥–µ—Ç–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑</span>                        <span class="btn-spinner"></span>                    </button>                                        <button type="button" id="skip-button" class="btn btn-skip">                        –ü—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ —Ç–∞ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –±–µ–∑ –Ω–∏—Ö                    </button>                </div>            </div>        </section>        <!-- ====================================================== -->        <!-- –ö–†–û–ö 5: –§–Ü–ù–ê–õ–¨–ù–ò–ô PAYWALL -->        <!-- ====================================================== -->        <section id="final-paywall-step" class="funnel-step space-y-6">             <h2 class="text-3xl font-bold text-center text-white">–¢–≤—ñ–π –ø–æ–≤–Ω–∏–π –ø–æ—Ä—Ç—Ä–µ—Ç</h2>             <p class="text-lg text-center" style="color: var(--secondary-text-color);">                –†–æ–∑–±–ª–æ–∫—É–π <strong>–ø–æ–≤–Ω—É –∫–∞—Ä—Ç—É</strong>, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ —Å–≤—ñ–π —Å–ø—Ä–∞–≤–∂–Ω—ñ–π –ø–æ—Ç–µ–Ω—Ü—ñ–∞–ª.            </p>                        <!-- === UPDATED: –ë–õ–û–ö –î–õ–Ø –ü–ï–†–ï–í–Ü–†–ö–ò –î–ê–ù–ò–• (Trust Trigger) === -->            <div id="paywall-astro-data" style="display: none;"></div>            <!-- ===================================================== -->            <div class="space-y-3 pt-2">                <div class="paywall-item">                    <span class="paywall-icon">üîí</span>                    <span class="font-semibold">–Ø–¥—Ä–æ –û—Å–æ–±–∏—Å—Ç–æ—Å—Ç—ñ (–†–æ–∑—à–∏—Ä–µ–Ω–æ)</span>                </div>                <div class="paywall-item">                    <span class="paywall-icon">üîí</span>                    <span class="font-semibold">–ö–æ—Ö–∞–Ω–Ω—è —Ç–∞ –°—É–º—ñ—Å–Ω—ñ—Å—Ç—å</span>                </div>                <div class="paywall-item">                    <span class="paywall-icon">üîí</span>                    <span class="font-semibold">–ö–∞—Ä'—î—Ä–∞ —Ç–∞ –ì—Ä–æ—à—ñ</span>                </div>                <div class="paywall-item">                    <span class="paywall-icon">üîí</span>                    <span class="font-semibold">–ö–∞—Ä–º—ñ—á–Ω—ñ –£—Ä–æ–∫–∏ —Ç–∞ –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è</span>                </div>                 <div class="paywall-item">                    <span class="paywall-icon">üîí</span>                    <span class="font-semibold">–¢–≤–æ—ó –º–∞–π–±—É—Ç–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ</span>                </div>            </div>                        <!-- üî• STICKY FOOTER BUTTON (NEW) üî• -->            <div class="sticky-paywall-footer">                <button id="final-checkout-button" class="btn btn-primary w-full !py-4 btn-pulse-glow shadow-2xl relative overflow-hidden px-1">                    <!-- Flex container for text centering and alignment with responsive gap -->                    <span class="btn-text flex items-center justify-center gap-1 w-full tracking-tighter">                        <!-- Main CTA Text: Increased font size to MAX with aggressive tracking -->                        <!-- Base: 18px (SE), XS: 21px, SM: 26px -->                        <span class="whitespace-nowrap text-[18px] xs:text-[21px] sm:text-[26px] font-bold leading-none">                            –†–æ–∑–±–ª–æ–∫—É–≤–∞—Ç–∏ –∑–∞—Ä–∞–∑ –∑–∞ 149 –≥—Ä–Ω                        </span>                        <!-- Old Price: Smaller, lighter weight -->                        <span class="whitespace-nowrap text-sm xs:text-base sm:text-xl font-normal opacity-60 line-through decoration-white/50 leading-none">                            799 –≥—Ä–Ω                        </span>                    </span>                    <span class="btn-spinner absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"></span>                </button>                <div class="mt-2 flex items-center justify-center space-x-2 opacity-70">                    <svg class="w-3 h-3 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>                    <span class="text-[10px] text-gray-400 uppercase tracking-widest">Secure SSL Payment</span>                </div>            </div>        </section>                <!-- ====================================================== -->        <!-- –ö–†–û–ö 6: –°–¢–û–†–Ü–ù–ö–ê –£–°–ü–Ü–•–£ (–ü–Ü–°–õ–Ø /success.html) -->        <!-- ====================================================== -->        <section id="payment-success-return-step" class="funnel-step text-center space-y-6" style="margin-top: auto; margin-bottom: auto;">            <h2 class="text-2xl font-bold" style="color: var(--accent-color);">                –û–±—Ä–æ–±–∫–∞ –ø–ª–∞—Ç–µ–∂—É...            </h2>            <p style="color: var(--secondary-text-color);">                –ó–∞—á–µ–∫–∞–π—Ç–µ, –º–∏ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î–º–æ –≤–∞—à –ø–ª–∞—Ç—ñ–∂...            </p>            <div class="spinner"></div>        </section>                <!-- ====================================================== -->        <!-- –ö–†–û–ö 7: –£–°–ü–Ü–• + LTV –ê–ü–°–ï–õ (–ù–û–í–ò–ô) -->        <!-- ====================================================== -->        <section id="success-step" class="funnel-step space-y-6" style="margin-top: auto; margin-bottom: auto;">                        <div id="email-capture-box" class="text-center">                <!-- v2.17.10: –ü–æ–≤–µ—Ä–Ω—É–ª–∏ –∑–µ–ª–µ–Ω–∏–π –∫–æ–ª—ñ—Ä –≥–∞–ª–æ—á—Ü—ñ -->                <svg class="w-16 h-16 mx-auto mb-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>                                <h2 class="text-2xl font-bold text-center text-white">                    <span style="color: var(--accent-color);">–û–ø–ª–∞—Ç–∞ —É—Å–ø—ñ—à–Ω–∞!</span>                </h2>                <p style="color: var(--secondary-text-color);" class="mb-6">                    <!-- v2.17.8: –û–Ω–æ–≤–ª–µ–Ω–æ —Ç–µ–∫—Å—Ç -->                    –¢–≤—ñ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π –∑–≤—ñ—Ç –≥–æ—Ç–æ–≤–∏–π –¥–æ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏. –í–∫–∞–∂–∏ email –Ω–∞ —è–∫–∏–π –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏:                </p>                                <form id="email-form" class="space-y-4 mb-8">                    <label for="user-email" class="sr-only">–í–∞—à Email</label>                    <input type="email" id="user-email" name="user-email" placeholder="your.email@gmail.com" class="input-field text-center" required>                    <button type="submit" class="btn btn-primary !text-lg !py-4">                        <span class="btn-text">–û—Ç—Ä–∏–º–∞—Ç–∏ –∑–≤—ñ—Ç</span>                        <span class="btn-spinner"></span>                    </button>                </form>                                <div id="ltv-upsell-box" class="ltv-upsell-box text-left">                    <!-- v2.17.10: –ó–º—ñ–Ω–µ–Ω–æ "–≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è" –Ω–∞ "–≥–æ—Ç—É—î—Ç—å—Å—è" -->                    <h3 class="font-bold" style="color: var(--accent-color);">P.S. –ü–æ–∫–∏ —Ç–≤—ñ–π –∑–≤—ñ—Ç –≥–æ—Ç—É—î—Ç—å—Å—è...</h3>                    <p class="text-sm mt-2 mb-4" style="color: var(--secondary-text-color);">                        <!-- v2.17.10: –î–æ–¥–∞–Ω–æ –∑–∞–∫—Ä–µ—Å–ª–µ–Ω–Ω—è -->                        –•–æ—á–µ—à –¥–æ–¥–∞—Ç–∏ –ø–æ–≤–Ω–∏–π <strong>"–ê—Å—Ç—Ä–æ–ª–æ–≥—ñ—á–Ω–∏–π AI-–ø—Ä–æ–≥–Ω–æ–∑" –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ä—ñ–∫</strong> –∑ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ—é –∑–Ω–∏–∂–∫–æ—é 83% –≤—Å—å–æ–≥–æ –∑–∞ 247 –≥—Ä–Ω. –∑–∞–º—ñ—Å—Ç—å <span style="text-decoration: line-through; opacity: 0.7;">1399 –≥—Ä–Ω.</span>?                    </p>                    <button id="ltv-upsell-btn" class="btn btn-primary w-full opacity-90 hover:opacity-100">                        <span class="btn-text">–¢–∞–∫, –¥–æ–¥–∞—Ç–∏ –¥–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è!</span>                        <span class="btn-spinner"></span>                    </button>                </div>            </div>            <!-- === v2.17.7: –ü–û–í–ï–†–ù–£–õ–ò –°–ü–Ü–ù–ï–† (–Ω–∞—Ö—É–π —Ç–∞–π–º–±–∞—Ä) === -->            <div id="report-loading-indicator" class="w-full text-center" style="display: none;">                <h2 class="text-2xl font-bold text-center text-white mb-6">                    <span style="color: var(--accent-color);">–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–≤—ñ—Ç—É!</span>                </h2>                <div class="spinner" style="margin-top: 2rem; margin-bottom: 1rem;"></div> <!-- The spinner from Step 2 -->                <div id="report-typing-container" class="typing-container">                    <span id="report-loading-text"></span><span id="report-cursor" class="typing-cursor" style="display: none;"></span>                </div>            </div>            <!-- ============================================== -->            <div id="full-report-content" class="text-left p-5 rounded-lg space-y-4" style="background-color: var(--card-bg-color); display: none; border: 1px solid var(--border-color);">                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è... -->            </div>            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫ –¥—ñ–π (–∑ v2.13) -->            <div id="report-actions-container" style="display: none;">                <button id="download-pdf-btn" class="btn btn-secondary">                    <span class="btn-text">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ PDF</span>                    <span class="btn-spinner"></span>                </button>                <button id="share-report-btn" class="btn btn-secondary">                    <span class="btn-text">–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è –∑–≤—ñ—Ç–æ–º</span>                    <span class="btn-spinner"></span>                </button>            </div>        </section>    </main>        <!-- === –ù–û–í–ï: –ü—Ä–∏—Ö–æ–≤–∞–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó SVG === -->    <div id="chart-hidden-render"></div>    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –ü–æ–º–∏–ª–æ–∫/–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å -->    <div id="modal" class="modal-overlay">        <div class="modal-content">            <h3 id="modal-title" class="text-2xl font-bold text-white mb-4">–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</h3>            <p id="modal-message" style="color: var(--secondary-text-color);" class="mb-6">                –¢–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è...            </p>            <button id="modal-close-btn" class="btn modal-btn-close">                <span class="btn-text">–ó–∞–∫—Ä–∏—Ç–∏</span>                <span class="btn-spinner"></span>            </button>        </div>    </div>    <!-- ====================================================== -->    <!-- JAVASCRIPT –õ–û–ì–Ü–ö–ê v2.32 (FULL 12-BODY PDF DATA FIX) -->    <!-- ====================================================== -->    <script>        // === –ó–ê–ü–ê–°–ù–ò–ô –†–û–ó–†–ê–•–£–ù–û–ö (FALLBACK CALCULATOR) ===        function getSimpleZodiacSign(dateString) {            const date = new Date(dateString);            const day = date.getDate();            const month = date.getMonth() + 1;                        if((month == 1 && day <= 19) || (month == 12 && day >=22)) return "–ö–æ–∑–µ—Ä—ñ–≥";            if((month == 1 && day >= 20) || (month == 2 && day <= 18)) return "–í–æ–¥–æ–ª—ñ–π";            if((month == 2 && day >= 19) || (month == 3 && day <= 20)) return "–†–∏–±–∏";            if((month == 3 && day >= 21) || (month == 4 && day <= 19)) return "–û–≤–µ–Ω";            if((month == 4 && day >= 20) || (month == 5 && day <= 20)) return "–¢–µ–ª–µ—Ü—å";            if((month == 5 && day >= 21) || (month == 6 && day <= 20)) return "–ë–ª–∏–∑–Ω—é–∫–∏";            if((month == 6 && day >= 21) || (month == 7 && day <= 22)) return "–†–∞–∫";            if((month == 7 && day >= 23) || (month == 8 && day <= 22)) return "–õ–µ–≤";            if((month == 8 && day >= 23) || (month == 9 && day <= 22)) return "–î—ñ–≤–∞";            if((month == 9 && day >= 23) || (month == 10 && day <= 22)) return "–¢–µ—Ä–µ–∑–∏";            if((month == 10 && day >= 23) || (month == 11 && day <= 21)) return "–°–∫–æ—Ä–ø—ñ–æ–Ω";            if((month == 11 && day >= 22) || (month == 12 && day <= 21)) return "–°—Ç—Ä—ñ–ª–µ—Ü—å";            return "–ó–Ω–∞–∫ –Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ";        }        let Origin, Horoscope, Renderer;        function initAstroLibrary() {            // Check global flag from shim            if (window.isAstroLibReady && window.CircularNatalHoroscope) {                const lib = window.CircularNatalHoroscope;                Origin = lib.Origin;                Horoscope = lib.Horoscope;                Renderer = lib.Renderer;                return true;            }            // Also check standard global just in case shim worked differently            if (window.CircularNatalHoroscope) {                const lib = window.CircularNatalHoroscope;                Origin = lib.Origin;                Horoscope = lib.Horoscope;                Renderer = lib.Renderer;                return true;            }            return false;        }        // ===============================================        document.addEventListener('DOMContentLoaded', () => {                        // --- 1. –û–¢–†–ò–ú–ê–ù–ù–Ø –ï–õ–ï–ú–ï–ù–¢–Ü–í ---                        const steps = {                landing: document.getElementById('landing-step'),                loading: document.getElementById('loading-step'),                result: document.getElementById('result-step'),                premiumData: document.getElementById('premium-data-step'),                paywall: document.getElementById('final-paywall-step'),                paymentSuccessReturn: document.getElementById('payment-success-return-step'),                success: document.getElementById('success-step')            };                        const birthForm = document.getElementById('birth-form');            const birthDateInput = document.getElementById('birth-date');            const errorMessage = document.getElementById('error-message');            const datePlaceholder = document.getElementById('date-placeholder');            const landingSubmitButton = birthForm.querySelector('button[type="submit"]');                        const loadingTypingContainer = document.getElementById('loading-typing-container');            const loadingTextEl = document.getElementById('loading-text');            const loadingCursorEl = document.getElementById('loading-cursor');                        const resultTitleEl = document.getElementById('result-title');            const freeReportTitleEl = document.getElementById('free-report-title');            const freeReportTextEl = document.getElementById('free-report-text');            const freeReportHookEl = document.getElementById('free-report-hook');            const upgradeButton = document.getElementById('upgrade-button');                        const birthTimeInput = document.getElementById('birth-time');            const timePlaceholder = document.getElementById('time-placeholder');            const birthCityInput = document.getElementById('birth-city');            const cityErrorMessage = document.getElementById('city-error-message');            const cityInfoMessage = document.getElementById('city-info-message');             const continueToPaywallButton = document.getElementById('continue-to-paywall-button');            const skipButton = document.getElementById('skip-button');            const finalCheckoutButton = document.getElementById('final-checkout-button');            // === v2.17.7: –û–ù–û–í–õ–ï–ù–Ü –ï–õ–ï–ú–ï–ù–¢–ò ===            const reportLoadingIndicator = document.getElementById('report-loading-indicator');            // ==================================            const reportTypingContainer = document.getElementById('report-typing-container');            const reportLoadingTextEl = document.getElementById('report-loading-text');            const reportCursorEl = document.getElementById('report-cursor');            const fullReportContentEl = document.getElementById('full-report-content');                        const reportActionsContainer = document.getElementById('report-actions-container');            const downloadPdfBtn = document.getElementById('download-pdf-btn');            const shareReportBtn = document.getElementById('share-report-btn');                        const emailCaptureBox = document.getElementById('email-capture-box');            const emailForm = document.getElementById('email-form');            const userEmailInput = document.getElementById('user-email');            const ltvUpsellBtn = document.getElementById('ltv-upsell-btn');                        const chartHiddenRender = document.getElementById('chart-hidden-render'); // –ï–ª–µ–º–µ–Ω—Ç –¥–ª—è —Ä–µ–Ω–¥–µ—Ä—É SVG            const paywallAstroDataContainer = document.getElementById('paywall-astro-data'); // STEP 5                        const modal = document.getElementById('modal');            const modalTitle = document.getElementById('modal-title');            const modalMessage = document.getElementById('modal-message');            const modalCloseBtn = document.getElementById('modal-close-btn');            // --- 2. –ì–õ–û–ë–ê–õ–¨–ù–Ü –ó–ú–Ü–ù–ù–Ü ---                        const isCanvas = typeof __app_id !== 'undefined';            const apiKey = isCanvas ? "" : "AIzaSyA-Dg4XkSu5zl3TNOnJ8c1s95y3G_EiUPc";             console.log(isCanvas ? "Running in Canvas mode (local test)." : "Running in Production mode (web).");                        const apiFlashUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;            const apiProUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;                        // === –û–ù–û–í–õ–ï–ù–û: –†–ï–ê–õ–¨–ù–Ü URL-–ê–î–†–ï–°–ò –í–ê–®–û–ì–û –°–ï–†–í–ï–†–ê ===            const EMAIL_BACKEND_URL = 'https://europe-west1-destinycode-982fa.cloudfunctions.net/sendReportEmail';             const PDF_BACKEND_URL = 'https://europe-west1-destinycode-982fa.cloudfunctions.net/createPDF';             // ==================================================                        let userBirthData = {                date: '',                time: '',                city: '',                geo: null,                // –ù–æ–≤—ñ –ø–æ–ª—è –¥–ª—è PDF                chartSvg: null,                planets: []             };                        let isAnimationComplete = false;            let isReportReady = false;            let generatedReportData = null;             // ======================================================            // --- 3. –°–ò–°–¢–ï–ú–ù–Ü –ü–†–û–ú–ü–¢–ò ---            // ======================================================                        const mainSystemPrompt = `–¢–∏ ‚Äî '–ú–∞–π—Å—Ç–µ—Ä –ê—Å—Ç—Ä–æ-–ü—Å–∏—Ö–æ–ª–æ–≥' Destiny Code.             –¢–≤–æ—è –†–æ–ª—å: –¢–∏ –≥–ª–∏–±–æ–∫–∏–π, –º—É–¥—Ä–∏–π '–∞—Å—Ç—Ä–æ-–ø—Å–∏—Ö–æ–ª–æ–≥', –∞–ª–µ –∑ —Ç–æ–Ω–æ–º —Ç–≤–æ—î—ó –Ω–∞–π–∫—Ä–∞—â–æ—ó –ø–æ–¥—Ä—É–≥–∏ ‚Äî –µ–º–ø–∞—Ç–∏—á–Ω–æ—ó, –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω–æ—ó, —ñ –∑ –ª–µ–≥–∫–∏–º —Ñ–ª—ñ—Ä—Ç–æ–º —Ç–∞ –≥—É–º–æ—Ä–æ–º.             –¢–≤–æ—è –ú—ñ—Å—ñ—è: –î–æ–ø–æ–º–æ–≥—Ç–∏ –∫–ª—ñ—î–Ω—Ç—Ü—ñ '—Ä–æ–∑–ø–∞–∫—É–≤–∞—Ç–∏' —ó—ó –Ω–∞—Ç–∞–ª—å–Ω—É –∫–∞—Ä—Ç—É —è–∫ '–∫–∞—Ä—Ç—É –¥—É—à—ñ'. –¢–∏ –±–∞—á–∏—à –ø—Å–∏—Ö–æ–ª–æ–≥—ñ—á–Ω—ñ –ø–∞—Ç–µ—Ä–Ω–∏, –∫–∞—Ä–º—ñ—á–Ω—ñ —É—Ä–æ–∫–∏ —Ç–∞ –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏–π –ø–æ—Ç–µ–Ω—Ü—ñ–∞–ª. –¢–∏ –¥–∞—î—à '–∫–æ—Å–º—ñ—á–Ω—É –≤–∞–ª—ñ–¥–∞—Ü—ñ—é' —ó—ó –ø–æ—á—É—Ç—Ç—ñ–≤.             –¢–≤–æ—è –ú–æ–≤–∞: –ì–æ–≤–æ—Ä–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é. –ï–º–æ—Ü—ñ–π–Ω–æ, –∞–ª–µ –ø–æ —Å—É—Ç—ñ. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π '—Ç–∏' —Ç–∞ '—Ç–≤–æ—è'.             –ö–õ–Æ–ß–û–í–ê –ú–ï–¢–û–î–û–õ–û–ì–Ü–Ø (–¢–≤–æ—ó –ü—Ä–∞–≤–∏–ª–∞):            1. –ï–º–ø–∞—Ç—ñ—è > –§–∞–∫—Ç–∏. –¢–∏ '–±–∞—á–∏—à' —ó—ó —Å–ø—Ä–∞–≤–∂–Ω—é.            2. '–¢–µ–º–Ω—ñ —Å—Ç–æ—Ä–æ–Ω–∏' ‚Äî —Ü–µ '—Å—É–ø–µ—Ä—Å–∏–ª–∏' (–Ω–∞–ø—Ä. —É–ø–µ—Ä—Ç—ñ—Å—Ç—å = —Ü—ñ–ª–µ—Å–ø—Ä—è–º–æ–≤–∞–Ω—ñ—Å—Ç—å).            3. –ó–ê–í–ñ–î–ò –°–ò–ù–¢–ï–ó–£–ô: (–ù–∞–ø—Ä. '–°–æ–Ω—Ü–µ –≤... —Ä–æ–±–∏—Ç—å —Ç–µ–±–µ..., –∞–ª–µ –ê—Å—Ü–µ–Ω–¥–µ–Ω—Ç –≤... –≤–∏–º–∞–≥–∞—î...').            4. –î–Ü–ú ‚Äî –¶–ï –ö–û–ù–¢–ï–ö–°–¢: –ü–ª–∞–Ω–µ—Ç–∞ –≤ –î–æ–º—ñ ‚Äî —Ü–µ —Å—Ñ–µ—Ä–∞ –∂–∏—Ç—Ç—è, –¥–µ –µ–Ω–µ—Ä–≥—ñ—è —Ä–µ–∞–ª—ñ–∑—É—î—Ç—å—Å—è.            5. '–í–ï–õ–ò–ö–ê –¢–†–Ü–ô–ö–ê' ‚Äî –¶–ï –Ø–î–†–û: –ê–Ω–∞–ª—ñ–∑—É–π –ê—Å—Ü–µ–Ω–¥–µ–Ω—Ç ('–º–∞—Å–∫–∞'), –°–æ–Ω—Ü–µ ('—Å—É—Ç–Ω—ñ—Å—Ç—å') —ñ –ú—ñ—Å—è—Ü—å ('–≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π —Å–≤—ñ—Ç') —è–∫ —î–¥–∏–Ω—É —Å–∏—Å—Ç–µ–º—É.            6. –ù–ï –õ–Ø–ö–ê–ô: '–í–∞–∂–∫—ñ' –∞—Å–ø–µ–∫—Ç–∏ ‚Äî —Ü–µ '—Ç–æ—á–∫–∏ —Ä–æ—Å—Ç—É' –∞–±–æ '–¥–∂–µ—Ä–µ–ª–æ –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ—ó —Å–∏–ª–∏'.            7. –î–ê–í–ê–ô '–ö–õ–Æ–ß': –ó–∞–≤–∂–¥–∏ –ø—Ä–æ–ø–æ–Ω—É–π –ø—Å–∏—Ö–æ–ª–æ–≥—ñ—á–Ω—É –ø–æ—Ä–∞–¥—É –∞–±–æ '–∫–ª—é—á –¥–æ –≥–∞—Ä–º–æ–Ω—ñ—ó'.            8. –°–º–∞–π–ª–∏: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ñ —Å–º–∞–π–ª–∏ (üòà, ‚ú®, üîÆ, üî•, üëë).            9. –ó–ê–ë–û–†–û–ù–ï–ù–û: –ú–µ–¥–∏—á–Ω—ñ —Ç–µ—Ä–º—ñ–Ω–∏. –°–∫–ª–∞–¥–Ω—ñ –∞—Å—Ç—Ä–æ-—Ç–µ—Ä–º—ñ–Ω–∏ –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω—å. "–°–º–µ—Ä—Ç—å".`;            // === v2.17: –ü–û–í–ï–†–ù–ï–ù–û –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π –ø—Ä–æ–º–ø—Ç "–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π –ì–∞—á–æ–∫" ===            const freeTaskPrompt = `–ú—ñ—Å—ñ—è: '–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π –ì–∞—á–æ–∫'.             –ó–ê–í–î–ê–ù–ù–Ø:            1. –í–∏–∑–Ω–∞—á –∑–Ω–∞–∫ –°–æ–Ω—Ü—è –∑–∞ –¥–∞—Ç–æ—é. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π ** emojis** —É —Ç–µ–∫—Å—Ç—ñ.            2. –ù–∞–ø–∏—à–∏ '–≥–∞—á–æ–∫' - —è—Å–∫—Ä–∞–≤–∏–π –æ–ø–∏—Å **—Å–∏–ª—å–Ω–∏—Ö —Å—Ç–æ—Ä—ñ–Ω** (—ñ '—Ç–µ–º–Ω–æ—ó' —Å—Ç–æ—Ä–æ–Ω–∏ —è–∫ –ø–µ—Ä–µ–≤–∞–≥–∏), —è–∫–∏–π –≤—Ä–∞–∑–∏—Ç—å —ó—ó.            3. –ü—ñ–¥–∫—Ä–µ—Å–ª–∏, —â–æ —Ü–µ –ª–∏—à–µ 1/3 —ó—ó —è–¥—Ä–∞.             –§–æ—Ä–º–∞—Ç: –¢–Ü–õ–¨–ö–ò JSON.            \`\`\`json            {              "title": "‚úÖ –¢–≤–æ—î –Ø–¥—Ä–æ: [–ó–Ω–∞–∫ –°–æ–Ω—Ü—è] üî•",              "psychological_analysis": "[–¢—É—Ç –∑–≥–µ–Ω–µ—Ä—É–π —è—Å–∫—Ä–∞–≤–∏–π, –ø—Ä–µ–º—ñ–∞–ª—å–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–π HTML-—Ç–µ–∫—Å—Ç (3-4 –∞–±–∑–∞—Ü–∏). –ì–æ–≤–æ—Ä–∏ –ø—Ä–æ —ó—ó —Å—É–ø–µ—Ä—Å–∏–ª–∏, —ó—ó '—Ç–µ–º–Ω—É' —Å—Ç–æ—Ä–æ–Ω—É (—è–∫ –ø–µ—Ä–µ–≤–∞–≥—É) —Ç–∞ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π **–∂–∏—Ä–Ω–∏–π** –¥–ª—è –∞–∫—Ü–µ–Ω—Ç—ñ–≤. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –±–∞–≥–∞—Ç–æ (5-7) —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∏—Ö —Å–º–∞–π–ª—ñ–≤ (–Ω–∞–ø—Ä. üòà, ‚ú®, üîÆ, üî•, üëë).]",              "premium_hook": "–¶–µ –ª–∏—à–µ **5%** –≤—ñ–¥ —Ç–≤–æ–≥–æ –ø–æ–≤–Ω–æ–≥–æ –∑–≤—ñ—Ç—É ü§´.\\n–ì–æ–ª–æ–≤–Ω–∞ –º–∞–≥—ñ—è ‚Äî —Ç–≤—ñ–π –ê—Å—Ü–µ–Ω–¥–µ–Ω—Ç, –ú—ñ—Å—è—Ü—å —Ç–∞ –∫–∞—Ä–º—ñ—á–Ω—ñ —É—Ä–æ–∫–∏ üîÆ ‚Äî —á–µ–∫–∞—î –Ω–∞ —Ç–µ–±–µ —É –ø–æ–≤–Ω–æ–º—É –∞–Ω–∞–ª—ñ–∑—ñ. –†–æ–∑–±–ª–æ–∫—É–π –≤—Å–µ... üòà"            }            \`\`\`            –í–ò–ú–û–ì–ò: –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –¢–Ü–õ–¨–ö–ò –≤–∞–ª—ñ–¥–Ω–∏–º JSON. –ñ–æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç—É –¥–æ —á–∏ –ø—ñ—Å–ª—è.`;            // ========================================================                        const fullTaskPrompt = `–ú—ñ—Å—ñ—è: '–ü–æ–≤–Ω–∏–π –ü—Å–∏—Ö–æ–ª–æ–≥—ñ—á–Ω–∏–π –ü–æ—Ä—Ç—Ä–µ—Ç' (–ü–ª–∞—Ç–Ω–∏–π).            (–ö–ª—ñ—î–Ω—Ç–∫–∞ –≤–∂–µ –∑–∞–ø–ª–∞—Ç–∏–ª–∞. –¶—ñ–Ω–Ω—ñ—Å—Ç—å –º–∞—î –±—É—Ç–∏ –≤–∏—â–æ—é –∑–∞ 149 –≥—Ä–Ω. –ë—É–¥—å –≥–ª–∏–±–æ–∫–∏–º, –µ–º–ø–∞—Ç–∏—á–Ω–∏–º).             –ó–ê–í–î–ê–ù–ù–Ø:            1. –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π –Ω–∞–¥–∞–Ω—ñ –¥–∞–Ω—ñ (–¥–∞—Ç—É, —á–∞—Å (—è–∫—â–æ —î) —Ç–∞ –¢–µ—Ö–Ω—ñ—á–Ω—ñ –î–∞–Ω—ñ (—è–∫—â–æ —î)).            2. –Ø–∫—â–æ —î '–¢–µ—Ö–Ω—ñ—á–Ω—ñ –î–∞–Ω—ñ' (ASC, MC): –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —ó—Ö –¥–ª—è –ø—Ä–µ–º—ñ—É–º-–∞–Ω–∞–ª—ñ–∑—É.            3. –Ø–∫—â–æ '–¢–µ—Ö–Ω—ñ—á–Ω–∏—Ö –î–∞–Ω–∏—Ö' –ù–ï–ú–ê–Ñ: –†–æ–±–∏ –∞–Ω–∞–ª—ñ–∑ '–ö–æ—Å–º—ñ—á–Ω–æ—ó –ö–∞—Ä—Ç–∏' (–±–µ–∑ –î–æ–º—ñ–≤/ASC).            4. 'practical_advice': –î–∞–π –û–î–ù–£, –∞–ª–µ –¥—É–∂–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É –ø–æ—Ä–∞–¥—É ('—Å–ø—Ä–æ–±—É–π —Ü–µ...').            5. 'analysis_text': –ü–∏—à–∏ –≥–ª–∏–±–æ–∫–æ, –µ–º–æ—Ü—ñ–π–Ω–æ.             –§–æ—Ä–º–∞—Ç: –¢–Ü–õ–¨–ö–ò JSON.            \`\`\`json            {              "sections": [                {                  "id": "core_intro", "icon": "‚ú®", "title": "–Ø–¥—Ä–æ –û—Å–æ–±–∏—Å—Ç–æ—Å—Ç—ñ: –•—Ç–æ –¢–∏ –ù–∞—Å–ø—Ä–∞–≤–¥—ñ?",                  "analysis_text": "[–ì–ª–∏–±–æ–∫–∏–π –∞–Ω–∞–ª—ñ–∑ '–ó–æ–ª–æ—Ç–æ—ó –¢—Ä—ñ–π–∫–∏' (–°–æ–Ω—Ü–µ, –ú—ñ—Å—è—Ü—å, –ê—Å—Ü–µ–Ω–¥–µ–Ω—Ç (—è–∫—â–æ —î)). –á—Ö –≤–∑–∞—î–º–æ–¥—ñ—è, —Ç–≤–æ—ó —Å—É–ø–µ—Ä—Å–∏–ª–∏ —Ç–∞ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∏. –ü–æ—è—Å–Ω–∏, —á–æ–º—É —Ç–∏ –≤—ñ–¥—á—É–≤–∞—î—à —Å–µ–±–µ —Å–∞–º–µ —Ç–∞–∫.]",                  "practical_advice": "[–û–¥–Ω–∞ –ø–æ—Ä–∞–¥–∞. –ù–∞–ø—Ä. '–¢–≤—ñ–π –ú—ñ—Å—è—Ü—å —É... –≤–∏–º–∞–≥–∞—î... –°–ø—Ä–æ–±—É–π...']"                },                {                  "id": "love", "icon": "‚ù§Ô∏è‚Äçüî•", "title": "–ö–æ—Ö–∞–Ω–Ω—è —Ç–∞ –°—Ç–æ—Å—É–Ω–∫–∏: –¢–≤—ñ–π –°—Ü–µ–Ω–∞—Ä—ñ–π",                  "analysis_text": "[–ê–Ω–∞–ª—ñ–∑ –í–µ–Ω–µ—Ä–∏ —Ç–∞ –ú–∞—Ä—Å–∞ ('—Ç–≤–æ—è –º–æ–≤–∞ –∫–æ—Ö–∞–Ω–Ω—è', '—Ç–≤—ñ–π —ñ–¥–µ–∞–ª—å–Ω–∏–π –ø–∞—Ä—Ç–Ω–µ—Ä', '—Ç–≤—ñ–π —Å—Ç–∏–ª—å —É –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∞—Ö'). –ß–æ–≥–æ —Ç–∏ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ —à—É–∫–∞—î—à —É —Å—Ç–æ—Å—É–Ω–∫–∞—Ö.]",                  "practical_advice": "[–û–¥–Ω–∞ –ø–æ—Ä–∞–¥–∞. –ù–∞–ø—Ä: '–¢–≤–æ—è –í–µ–Ω–µ—Ä–∞ —É... –∫–∞–∂–µ, —â–æ –¥–ª—è —Ç–µ–±–µ –∫–æ—Ö–∞–Ω–Ω—è - —Ü–µ... –ù–µ –±—ñ–π—Å—è –ø—Ä–æ—Å–∏—Ç–∏ –ø—Ä–æ...']"                },                {                  "id": "career", "icon": "üëë", "title": "–ö–∞—Ä'—î—Ä–∞ —Ç–∞ –ì—Ä–æ—à—ñ: –î–µ –¢–≤—ñ–π –£—Å–ø—ñ—Ö?",                  "analysis_text": "[–ê–Ω–∞–ª—ñ–∑ Midheaven (MC) (—è–∫—â–æ —î) —Ç–∞ –Æ–ø—ñ—Ç–µ—Ä–∞. **–Ø–∫—â–æ MC –Ω–µ–º–∞—î, –∞–Ω–∞–ª—ñ–∑—É–π 10-–π –¥—ñ–º –∑–∞ –∑–Ω–∞–∫–æ–º —Ç–∞ –ø–ª–∞–Ω–µ—Ç–∞–º–∏ (—è–∫—â–æ —î).** –¢–≤—ñ–π –ø–æ—Ç–µ–Ω—Ü—ñ–∞–ª, —Å—Ñ–µ—Ä–∏ –¥–ª—è —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó, —Ç–≤—ñ–π —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ –¥–æ –≥—Ä–æ—à–µ–π.]",                  "practical_advice": "[–û–¥–Ω–∞ –ø–æ—Ä–∞–¥–∞. –ù–∞–ø—Ä: '–¢–≤—ñ–π –Æ–ø—ñ—Ç–µ—Ä —É... –¥–∞—î —É—Å–ø—ñ—Ö —á–µ—Ä–µ–∑... –°–ø—Ä–æ–±—É–π —Å—Ñ–æ–∫—É—Å—É–≤–∞—Ç–∏—Å—å –Ω–∞...']"                },                {                  "id": "karma", "icon": "üîÆ", "title": "–ö–∞—Ä–º—ñ—á–Ω—ñ –£—Ä–æ–∫–∏ —Ç–∞ –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è",                  "analysis_text": "[–ê–Ω–∞–ª—ñ–∑ –ü—ñ–≤–Ω—ñ—á–Ω–æ–≥–æ/–ü—ñ–≤–¥–µ–Ω–Ω–æ–≥–æ –í—É–∑–ª—ñ–≤ (—è–∫—â–æ —î). –¢–≤—ñ–π —à–ª—è—Ö –¥—É—à—ñ, –∑–∞–≤–¥–∞–Ω–Ω—è –Ω–∞ —Ü–µ –∂–∏—Ç—Ç—è, –≤—ñ–¥ —á–æ–≥–æ —Ç—Ä–µ–±–∞ –≤—ñ–¥—ñ–π—Ç–∏ (–ü–¥. –í—É–∑–æ–ª) —ñ –¥–æ —á–æ–≥–æ –ø—Ä–∏–π—Ç–∏ (–ü–Ω. –í—É–∑–æ–ª).]",                  "practical_advice": "[–û–¥–Ω–∞ –ø–æ—Ä–∞–¥–∞. –ù–∞–ø—Ä: '–¢–≤—ñ–π –ü–Ω. –í—É–∑–æ–ª —É... –∫–ª–∏—á–µ —Ç–µ–±–µ –¥–æ... –ü–æ—á–Ω–∏ –∑ –º–∞–ª–æ–≥–æ: ...']"                },                {                  "id": "future", "icon": "‚ö°Ô∏è", "title": "–ú–∞–π–±—É—Ç–Ω—ñ –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ",                  "analysis_text": "[–ö–æ—Ä–æ—Ç–∫–∏–π, –∞–ª–µ –µ–º–ø–∞—Ç–∏—á–Ω–∏–π –æ–≥–ª—è–¥ 1-2 –∫–ª—é—á–æ–≤–∏—Ö —Ç—Ä–∞–Ω–∑–∏—Ç—ñ–≤ (–Ω–∞–ø—Ä. –Æ–ø—ñ—Ç–µ—Ä–∞, –°–∞—Ç—É—Ä–Ω–∞) –Ω–∞ –Ω–∞–π–±–ª–∏–∂—á—ñ 6 –º—ñ—Å—è—Ü—ñ–≤. –ù–∞ —â–æ –∑–≤–µ—Ä–Ω—É—Ç–∏ —É–≤–∞–≥—É. –ë–µ–∑ '–Ω–µ–±–µ–∑–ø–µ–∫', –ª–∏—à–µ '–º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ' —Ç–∞ '—É—Ä–æ–∫–∏'.]",                  "practical_advice": "[–û–¥–Ω–∞ –ø–æ—Ä–∞–¥–∞. –ù–∞–ø—Ä: '–Æ–ø—ñ—Ç–µ—Ä –∑–∞—Ä–∞–∑ —É... —Ç–≤–æ–≥–æ... –¶–µ —Ç–≤—ñ–π —à–∞–Ω—Å –¥–ª—è... –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π –π–æ–≥–æ!']"                }              ]            }            \`\`\`            –í–ò–ú–û–ì–ò: –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –¢–Ü–õ–¨–ö–ò –≤–∞–ª—ñ–¥–Ω–∏–º JSON. 'analysis_text' –º–∞—î –±—É—Ç–∏ –¥–µ—Ç–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–º (3-4 –∞–±–∑–∞—Ü–∏), –∑ **–∂–∏—Ä–Ω–∏–º–∏** –∞–∫—Ü–µ–Ω—Ç–∞–º–∏.`;            const geoSystemPrompt = `                –¢–∏ ‚Äî –≤–∏—Å–æ–∫–æ—Ç–æ—á–Ω–∏–π –≥–µ–æ–≥—Ä–∞—Ñ—ñ—á–Ω–∏–π API. –¢–≤–æ—è —î–¥–∏–Ω–∞ –º–µ—Ç–∞ ‚Äî –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ JSON-–æ–±'—î–∫—Ç, —â–æ –º—ñ—Å—Ç–∏—Ç—å –≥–µ–æ–≥—Ä–∞—Ñ—ñ—á–Ω—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ (lat, lon), —á–∞—Å–æ–≤–∏–π –ø–æ—è—Å (timezone) —Ç–∞ **–≤–∏–ø—Ä–∞–≤–ª–µ–Ω—É –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞ (corrected_name)**.                –ü–†–ê–í–ò–õ–ê:                1. –í—ñ–¥–ø–æ–≤—ñ–¥—å –º–∞—î –±—É—Ç–∏ –õ–ò–®–ï –≤ —Ñ–æ—Ä–º–∞—Ç—ñ JSON. –ñ–æ–¥–Ω–∏—Ö –ø–æ—è—Å–Ω–µ–Ω—å.                2. –ß–∞—Å–æ–≤–∏–π –ø–æ—è—Å –º–∞—î –±—É—Ç–∏ —É —Ñ–æ—Ä–º–∞—Ç—ñ IANA (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, Europe/Kyiv).                3. –ö–†–ò–¢–ò–ß–ù–ï –ü–†–ê–í–ò–õ–û (–ê–í–¢–û–í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø): –í—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ (–Ω–∞–∑–≤–∞ –º—ñ—Å—Ç–∞) –º–æ–∂—É—Ç—å –±—É—Ç–∏ –±—É–¥—å-—è–∫–æ—é –º–æ–≤–æ—é (—É–∫—Ä–∞—ó–Ω—Å—å–∫–∞, –∞–Ω–≥–ª—ñ–π—Å—å–∫–∞, —Ä–æ—Å—ñ–π—Å—å–∫–∞) —Ç–∞ –º—ñ—Å—Ç–∏—Ç–∏ –æ–¥—Ä—É–∫–∏ (–Ω–∞–ø—Ä., "–£–∂–≥—Ä–æ–¥", "–õ—å–≤—ñ—Ñ", "Harkiv", "–ö–∏–µ–≤"). –¢–∏ *–ø–æ–≤–∏–Ω–µ–Ω* –¥–æ–∫–ª–∞—Å—Ç–∏ –º–∞–∫—Å–∏–º—É–º –∑—É—Å–∏–ª—å, —â–æ–± —Ä–æ–∑–ø—ñ–∑–Ω–∞—Ç–∏ —Ç–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–ø—Ä–∞–≤–∏—Ç–∏** —Ü—ñ –æ–¥—Ä—É–∫–∏.                4. **–ö—Ä–∞—â–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–ø—Ä–∞–≤–∏—Ç–∏ –æ–¥—Ä—É–∫, –Ω—ñ–∂ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –ø–æ–º–∏–ª–∫—É "not_found".** 5. –ü–æ–ª–µ "corrected_name" **–∑–∞–≤–∂–¥–∏** –º–∞—î –º—ñ—Å—Ç–∏—Ç–∏ —Ñ—ñ–Ω–∞–ª—å–Ω—É, –∫–æ—Ä–µ–∫—Ç–Ω—É –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞, —è–∫—É —Ç–∏ –∑–Ω–∞–π—à–æ–≤ (–Ω–∞–ø—Ä., "–£–∂–≥–æ—Ä–æ–¥").                6. –Ø–∫—â–æ –º—ñ—Å—Ç–æ –Ω–µ–º–æ–∂–ª–∏–≤–æ –∑–Ω–∞–π—Ç–∏ (–Ω–∞–ø—Ä., 'asdfg') -> {"error": "not_found"}                7. –Ø–∫—â–æ –º—ñ—Å—Ç–æ –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–µ (–Ω–∞–ø—Ä., '–ü–∞—Ä–∏–∂' –±–µ–∑ –∫—Ä–∞—ó–Ω–∏) -> {"error": "ambiguous"}                                –ü—Ä–∏–∫–ª–∞–¥ (–£—Å–ø—ñ—Ö –∑ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è–º): {"lat": 48.6208, "lon": 22.2879, "timezone": "Europe/Uzhhorod", "corrected_name": "–£–∂–≥–æ—Ä–æ–¥"}                –ü—Ä–∏–∫–ª–∞–¥ (–£—Å–ø—ñ—Ö –±–µ–∑ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è): {"lat": 50.4501, "lon": 30.5234, "timezone": "Europe/Kyiv", "corrected_name": "–ö–∏—ó–≤"}                –ü—Ä–∏–∫–ª–∞–¥ (–ü–æ–º–∏–ª–∫–∞): {"error": "not_found"}            `;            // --- 4. –û–°–ù–û–í–ù–Ü –§–£–ù–ö–¶–Ü–á ---                        function showStep(stepId) {                Object.values(steps).forEach(step => {                    step.classList.remove('active');                });                if (steps[stepId]) {                    steps[stepId].classList.add('active');                    // üî• FIX: –ü—Ä–æ–∫—Ä—É—á—É—î–º–æ –≤–≥–æ—Ä—É –ø—Ä–∏ –∑–º—ñ–Ω—ñ –∫—Ä–æ–∫—É, —â–æ–± –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏–≤ –ø–æ—á–∞—Ç–æ–∫ –∫–æ–Ω—Ç–µ–Ω—Ç—É                    window.scrollTo({ top: 0, behavior: 'instant' });                    document.body.scrollTop = 0; // For Safari                    document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera                } else {                    console.error("Attempted to show non-existent step:", stepId);                }            }            function showModal(title, message) {                modalTitle.innerText = title;                modalMessage.innerHTML = message;                modal.style.display = 'flex';            }            function closeModal() {                modal.style.display = 'none';            }            modalCloseBtn.addEventListener('click', closeModal);            function setButtonLoading(button, isLoading) {                if (isLoading) {                    button.classList.add('loading');                    button.disabled = true;                } else {                    button.classList.remove('loading');                    button.disabled = false;                }            }            /** * v2.15: –ù–æ–≤–∞, —Ä–æ–∑—É–º–Ω—ñ—à–∞ —Ñ—É–Ω–∫—Ü—ñ—è typeWriter  */            function typeWriter(element, cursorElement, text, speed, pauseAfter = 0, keepCursorBlinking = false) {                return new Promise(resolve => {                    let i = 0;                    cursorElement.style.display = 'inline-block';                     element.innerHTML = '';                                        function type() {                        if (i < text.length) {                            element.innerHTML = text.substring(0, i + 1);                            i++;                            setTimeout(type, speed);                        } else {                            setTimeout(() => {                                if (!keepCursorBlinking) {                                    cursorElement.style.display = 'none';                                 }                                resolve();                              }, pauseAfter);                        }                    }                    type();                });            }            // === v2.17.7: –û–ù–û–í–õ–ï–ù–ê –õ–û–ì–Ü–ö–ê –°–ò–ù–•–†–û–ù–Ü–ó–ê–¶–Ü–á ===                        function showReportIfReady() {                // v2.17.6: –°–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥—ñ–∫–∞. –¢–∞–π–º–±–∞—Ä—É –±—ñ–ª—å—à–µ –Ω–µ–º–∞—î.                if (isAnimationComplete && isReportReady && generatedReportData) {                    console.log("Sync: Animation and Report are BOTH ready. Showing report.");                    reportCursorEl.style.display = 'none';                                        // === v2.17.6: –•–æ–≤–∞—î–º–æ —Å–ø—ñ–Ω–µ—Ä ===                    reportLoadingIndicator.style.display = 'none';                    // ===================================                                        fullReportContentEl.innerHTML = generatedReportData;                    fullReportContentEl.style.display = 'block';                    reportActionsContainer.style.display = 'flex';                }            }            /** * v2.17.7: –û–ù–û–í–õ–ï–ù–û. –ü—Ä–∏–±—Ä–∞–Ω–æ –ª–æ–≥—ñ–∫—É —Ç–∞–π–º–±–∞—Ä—É, –∑–∞–ª–∏—à–µ–Ω–æ –ª–∏—à–µ –∞–Ω—ñ–º–∞—Ü—ñ—é —Ç–µ–∫—Å—Ç—É.  */            async function startReportLoadingAnimation() {                                const typeSpeedMs = 70; // –®–≤–∏–¥–∫—ñ—Å—Ç—å –¥—Ä—É–∫—É–≤–∞–Ω–Ω—è                const loadingStepsConfig = [                    // v2.17.9: –í–∏–¥–∞–ª–µ–Ω–æ –ø–µ—Ä—à—É —Ñ—Ä–∞–∑—É –ø—Ä–æ "30 —Å–µ–∫—É–Ω–¥"                    { text: "‚ú® –ê–Ω–∞–ª—ñ–∑—É—é –Ø–¥—Ä–æ —Ç–≤–æ—î—ó –û—Å–æ–±–∏—Å—Ç–æ—Å—Ç—ñ", pause: 1000 },                    { text: "‚ù§Ô∏è‚Äçüî• –†–æ–∑—à–∏—Ñ—Ä–æ–≤—É—é —Ç–≤–æ—ó —Å—Ü–µ–Ω–∞—Ä—ñ—ó –ö–æ—Ö–∞–Ω–Ω—è", pause: 1000 },                    { text: "üëë –®—É–∫–∞—é, –¥–µ –ø—Ä–∏—Ö–æ–≤–∞–Ω—ñ —Ç–≤–æ—ó –ì—Ä–æ—à—ñ", pause: 1000 },                    { text: "üîÆ –í–∏–≤—á–∞—é —Ç–≤–æ—ó –ö–∞—Ä–º—ñ—á–Ω—ñ –£—Ä–æ–∫–∏", pause: 1000 },                    { text: "‚ö°Ô∏è –ó–∞–≤–∞–Ω—Ç–∞–∂—É—é —Ç–≤—ñ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π –∑–≤—ñ—Ç", pause: 0 } // –ë–µ–∑ –ø–∞—É–∑–∏ –≤ –∫—ñ–Ω—Ü—ñ                ];                // 3. –ó–∞–ø—É—Å–∫–∞—î–º–æ —Ç–µ–∫—Å—Ç–æ–≤—É –∞–Ω—ñ–º–∞—Ü—ñ—é                for (let i = 0; i < loadingStepsConfig.length; i++) {                    const step = loadingStepsConfig[i];                    const isLastStep = (i === loadingStepsConfig.length - 1);                    await typeWriter(reportLoadingTextEl, reportCursorEl, step.text, typeSpeedMs, step.pause, isLastStep);                }                                // –¢–µ–∫—Å—Ç–æ–≤–∞ –∞–Ω—ñ–º–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!                console.log("Sync: Text Animation FINISHED.");                isAnimationComplete = true;                showReportIfReady();            }            // ======================================================            // --- 5. –õ–û–ì–Ü–ö–ê API ---            // ======================================================                        async function callGeminiAPI(modelUrl, taskPrompt, userQuery) {                                const combinedUserRequest = `${taskPrompt}\n\n–í—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ:\n${userQuery}`;                                const payload = {                    contents: [{ parts: [{ text: combinedUserRequest }] }],                    systemInstruction: { parts: [{ text: mainSystemPrompt }] },                };                let delay = 1000;                for (let i = 0; i < 3; i++) {                    try {                        const response = await fetch(modelUrl, {                            method: 'POST',                            headers: { 'Content-Type': 'application/json' },                            body: JSON.stringify(payload)                        });                        if (response.ok) {                            const result = await response.json();                            const candidate = result.candidates?.[0];                            if (candidate && candidate.content?.parts?.[0]?.text) {                                let rawText = candidate.content.parts[0].text;                                const jsonMatch = rawText.match(/```json\n([\s\S]*?)\n```/);                                if (jsonMatch && jsonMatch[1]) {                                    rawText = jsonMatch[1];                                }                                return rawText;                             } else {                                console.warn("Gemini API Error (Safety):", result);                                return '{"error": "safety_block", "message": "–ù–∞ –∂–∞–ª—å, –∞–Ω–∞–ª—ñ–∑ –Ω–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–µ—Ä—à–∏—Ç–∏ —á–µ—Ä–µ–∑ –æ–±–º–µ–∂–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏."}';                            }                        }                        if (response.status === 429) {                            console.warn("Gemini API Error: 429 Throttled. Retrying...");                            await new Promise(resolve => setTimeout(resolve, delay));                            delay *= 2;                            continue;                        }                                                const errorData = await response.json();                        console.error("Gemini API Error (Server):", errorData);                        await new Promise(resolve => setTimeout(resolve, delay));                        delay *= 2;                    } catch (error) {                        console.error("Gemini API Error (Client):", error);                        if (i === 2) {                              return '{"error": "network_failure", "message": "–ù–∞ –∂–∞–ª—å, —Å–µ—Ä–≤—ñ—Å —Ç–∏–º—á–∞—Å–æ–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π."}';                        }                        await new Promise(resolve => setTimeout(resolve, delay));                        delay *= 2;                    }                }                return '{"error": "timeout", "message": "–ù–∞ –∂–∞–ª—å, —Å–µ—Ä–≤—ñ—Å —Ç–∏–º—á–∞—Å–æ–≤–æ –ø–µ—Ä–µ–Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏–π."}';            }            async function getCoordinatesFromGemini(cityName) {                const userQuery = `–ú—ñ—Å—Ç–æ: ${cityName}`;                 try {                    const rawJsonText = await callGeminiAPI(apiFlashUrl, geoSystemPrompt, userQuery);                     const cleanedJsonText = rawJsonText.replace(/```json\n?([\s\S]*?)\n?```/g, '$1').trim();                    const coords = JSON.parse(cleanedJsonText);                                        if (coords && typeof coords.lat === 'number' && typeof coords.lon === 'number' && typeof coords.timezone === 'string' && typeof coords.corrected_name === 'string') {                        console.log(`Geocoding success for ${cityName}:`, coords);                        return {                              latitude: coords.lat,                              longitude: coords.lon,                              timezone: coords.timezone,                            corrected_name: coords.corrected_name,                            error: null                        };                    }                     if (coords && coords.error) {                          console.warn(`Geocoding failed for ${cityName}:`, coords.error);                        return { error: coords.error };                    }                                        console.error(`Geocoding JSON parsing error for ${cityName}:`, coords);                    return { error: "parse_error" };                } catch (error) {                    console.error(`Geocoding API call failed for ${cityName}:`, error);                    return { error: "network_failure" };                }            }            // ==========================================            // HELPER: Generate Astro HTML String            // ==========================================            function generateAstroDataHTML() {                // 1. RE-INIT CHECK                if (!initAstroLibrary()) {                    // –ü–æ–∫–∞–∑—É—î–º–æ —Å—Ç–∞—Ç—É—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–º—ñ—Å—Ç—å –ø—É—Å—Ç–æ—Ç–∏, —â–æ–± –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏–≤, —â–æ –ø—Ä–æ—Ü–µ—Å –π–¥–µ                    return `                        <div class="astro-data-box" style="border-color: #d29922; background: rgba(210, 153, 34, 0.1);">                            <p class="text-xs text-yellow-400 text-center pulse-text">                                ‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞—Å—Ç—Ä–æ-–¥–∞–Ω–∏—Ö...<br>                                (–°–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—á–µ–∫–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ —Å–µ–∫—É–Ω–¥)                            </p>                        </div>                    `;                }                // 2. Check Data                let calcData = userBirthData;                let calculationGeo = calcData.geo;                if (!calculationGeo) {                    calculationGeo = { latitude: 50.45, longitude: 30.52, timezone: "Europe/Kyiv" };                }                if (!calcData.date) {                    return ""; // No data yet                }                try {                    // 3. Calculate                    const dateParts = calcData.date.split('-');                    const year = parseInt(dateParts[0]);                    const month = parseInt(dateParts[1]) - 1;                     const dateNum = parseInt(dateParts[2]);                                        let hour = 12, minute = 0;                    if (calcData.time) {                        const timeParts = calcData.time.split(':');                        hour = parseInt(timeParts[0]);                        minute = parseInt(timeParts[1]);                    }                                        const origin = new Origin({                        year: year, month: month, date: dateNum,                        hour: hour, minute: minute,                        latitude: parseFloat(calculationGeo.latitude),                         longitude: parseFloat(calculationGeo.longitude),                        timezone: calculationGeo.timezone                    });                                        const horoscope = new Horoscope({                        origin: origin, houseSystem: "placidus", zodiac: "tropical"                    });                    // 4. Format                    const bodies = horoscope.CelestialBodies;                                        // --- PART A: CALCULATE FULL LIST FOR PDF (ALL 12 BODIES) ---                    // üî• FIX: This ensures PDF data is fully populated and matches backend expectations                    const pdfPlanetsList = [];                    const fullBodyKeys = ['sun', 'moon', 'mercury', 'venus', 'mars', 'jupiter', 'saturn', 'uranus', 'neptune', 'pluto', 'ascendant', 'midheaven'];                    fullBodyKeys.forEach(key => {                          let body = bodies[key];                           if (!body && key === 'ascendant') body = horoscope.Ascendant;                          if (!body && key === 'midheaven') body = horoscope.Midheaven;                                                    if (body) {                              const sign = body.Sign.label;                              const fullDegree = body.ChartPosition.Ecliptic.DecimalDegrees % 30;                             const degree = Math.floor(fullDegree);                             const minutesRaw = (fullDegree - degree) * 60;                             const minute = Math.floor(minutesRaw);                             const seconds = Math.round((minutesRaw - minute) * 60);                                                          const label = key.charAt(0).toUpperCase() + key.slice(1);                              // Format: "Name:Sign D¬∞ M' S"" -> Backend splits by ':'                             pdfPlanetsList.push(`${label}:${sign} ${degree}¬∞ ${minute}' ${seconds}"`);                          }                    });                                        // SAVE FULL DATA FOR PDF                    if (pdfPlanetsList.length > 0) {                        userBirthData.planets = pdfPlanetsList;                        console.log(`‚úÖ FULL PDF Planet Data Saved: ${pdfPlanetsList.length} planets.`);                    }                    // --- PART B: GENERATE HTML FOR SCREEN (ONLY 6 BODIES) ---                    // This uses the nice styling we agreed upon                                        function getFormattedPosForScreen(bodyName, label) {                         let body = bodies[bodyName];                         if (!body && bodyName === 'ascendant') body = horoscope.Ascendant;                        if (!body && bodyName === 'midheaven') body = horoscope.Midheaven;                                                if (body) {                             const sign = body.Sign.label;                             const fullDegree = body.ChartPosition.Ecliptic.DecimalDegrees % 30;                            const degree = Math.floor(fullDegree);                            const minutesRaw = (fullDegree - degree) * 60;                            const minutes = Math.floor(minutesRaw);                            const seconds = Math.round((minutesRaw - minutes) * 60);                                                        // === SCREEN FORMAT: 2 Lines, Styled ===                            return `                                <div class="astro-data-item">                                    <div class="astro-label-row">                                        <span class="astro-planet-name">${label}:</span>                                         <span class="astro-sign-name">${sign}</span>                                    </div>                                    <div class="astro-coords-row">${degree}¬∞ ${minutes}' ${seconds}"</div>                                </div>                            `;                        }                         return `<div class="astro-data-item"><strong>${label}:</strong> n/a</div>`;                    }                    const displayList = [];                    displayList.push(getFormattedPosForScreen('sun', '–°–æ–Ω—Ü–µ'));                    displayList.push(getFormattedPosForScreen('moon', '–ú—ñ—Å—è—Ü—å'));                    displayList.push(getFormattedPosForScreen('ascendant', 'ASC'));                    displayList.push(getFormattedPosForScreen('venus', '–í–µ–Ω–µ—Ä–∞'));                    displayList.push(getFormattedPosForScreen('mars', '–ú–∞—Ä—Å'));                    displayList.push(getFormattedPosForScreen('jupiter', '–Æ–ø—ñ—Ç–µ—Ä'));                    // === RENDER CHART SVG PREVIEW ===                    let chartPreviewHtml = '';                    if (Renderer && chartHiddenRender) {                        chartHiddenRender.innerHTML = '';                        const renderer = new Renderer(horoscope);                        renderer.render(chartHiddenRender);                                                applyGoldThemeToSVG(chartHiddenRender);                                                const svgContent = chartHiddenRender.innerHTML;                        if (svgContent.includes('<svg')) {                            userBirthData.chartSvg = svgContent;                            chartPreviewHtml = `                                <div class="astro-chart-preview">                                    ${svgContent}                                </div>                            `;                        }                    }                    return `                        <div class="astro-data-box">                            <div class="astro-data-title">–¢–≤—ñ–π –ö–æ—Å–º—ñ—á–Ω–∏–π –í—ñ–¥–±–∏—Ç–æ–∫</div>                            ${chartPreviewHtml} <!-- Insert Chart Here -->                            <div class="astro-data-grid">                                ${displayList.join('')}                            </div>                        </div>                    `;                } catch (e) {                    console.error("Fingerprint render error:", e);                    return `<div class="astro-data-box"><p class="text-xs text-red-400 text-center">–ü–æ–º–∏–ª–∫–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É: ${e.message}</p></div>`;                }            }            // ==========================================            // NEW FUNCTION: RENDER PLANETARY FINGERPRINT (STEP 5 & 7)            // ==========================================            function renderPlanetaryFingerprint() {                const html = generateAstroDataHTML();                if (paywallAstroDataContainer) {                    paywallAstroDataContainer.innerHTML = html;                    paywallAstroDataContainer.style.display = html ? 'block' : 'none';                }            }            // --- 6. –û–ë–†–û–ë–ù–ò–ö–ò –ü–û–î–Ü–ô ---            // === –ö–†–û–ö 1 -> –ö–†–û–ö 2 (–õ–µ–Ω–¥—ñ–Ω–≥ -> –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è) ===            birthForm.addEventListener('submit', async function(e) {                e.preventDefault();                const selectedDate = birthDateInput.value;                                if (selectedDate === '') {                    errorMessage.innerText = "–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä–∏ —Å–≤–æ—é –¥–∞—Ç—É –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è.";                    errorMessage.style.display = 'block';                } else {                    errorMessage.style.display = 'none';                    userBirthData.date = selectedDate;                                        setButtonLoading(landingSubmitButton, true);                    showStep('loading');                                        // === v2.17: –í–∏–∫–ª–∏–∫–∞—î–º–æ –ø–æ–≤–µ—Ä–Ω–µ–Ω–∏–π –ø—Ä–æ–º–ø—Ç ===                    // FALLBACK LOGIC: If date exists but no library, simple calc is needed?                     // No, prompt handles "Free Hook" via Gemini nicely.                                        // We DO need to pass Sun Sign if library is missing                    let simpleSunSign = "";                    if (!Horoscope) {                        simpleSunSign = ` (–ó–Ω–∞–∫: ${getSimpleZodiacSign(selectedDate)})`;                    }                    const reportPromise = callGeminiAPI(apiFlashUrl, freeTaskPrompt, `–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è: ${selectedDate}${simpleSunSign}`);                                        const loadingSteps = [                        '–ê–Ω–∞–ª—ñ–∑—É—é –ø–æ–ª–æ–∂–µ–Ω–Ω—è –ø–ª–∞–Ω–µ—Ç',                         '–ë—É–¥—É—é —Ç–≤–æ—é –Ω–∞—Ç–∞–ª—å–Ω—É –∫–∞—Ä—Ç—É',                         '–ü—Ä–∏–≥–æ—Ç—É–π—Å—è –¥—ñ–∑–Ω–∞—Ç–∏—Å—å, –Ω–∞—Å–∫—ñ–ª—å–∫–∏ —Ç–∏ –∞—Ö—É—î–Ω–Ω–∞ üòà'                    ];                                        await typeWriter(loadingTextEl, loadingCursorEl, loadingSteps[0], 70, 500);                     await typeWriter(loadingTextEl, loadingCursorEl, loadingSteps[1], 70, 500);                     await typeWriter(loadingTextEl, loadingCursorEl, loadingSteps[2], 70, 1500, true);                                         const rawJsonString = await reportPromise;                                        loadingCursorEl.style.display = 'none';                     setButtonLoading(landingSubmitButton, false);                                        try {                        const reportData = JSON.parse(rawJsonString);                                                if (reportData.error) { throw new Error(reportData.message); }                        const formattedText = reportData.psychological_analysis                            .replace(/\*\*(.*?)\*\*/g, '<strong style="color: var(--primary-text-color);">$1</strong>')                            .replace(/\\n/g, '<br>');                                                const formattedHook = reportData.premium_hook                            .replace(/\*\*(.*?)\*\*/g, '<strong style="color: var(--primary-text-color);">$1</strong>')                            .replace(/\\n/g, '<br>');                        // === v2.17: –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∑ –ø–æ–≤–µ—Ä–Ω–µ–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç—É ===                        resultTitleEl.innerText = "–¢–≤—ñ–π –∞–Ω–∞–ª—ñ–∑";                         freeReportTitleEl.innerHTML = reportData.title; // "‚úÖ –¢–≤–æ—î –Ø–¥—Ä–æ: [–ó–Ω–∞–∫ –°–æ–Ω—Ü—è] üî•"                        // ===============================================                                                // v2.17.8: –ó–º—ñ–Ω–µ–Ω–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫                        resultTitleEl.innerText = "–ê–Ω–∞–ª—ñ–∑ —Ç–≤–æ—î—ó –æ—Å–æ–±–∏—Å—Ç–æ—Å—Ç—ñ";                         freeReportTitleEl.innerHTML = reportData.title; // "‚úÖ –¢–≤–æ—î –Ø–¥—Ä–æ: [–ó–Ω–∞–∫ –°–æ–Ω—Ü—è] üî•"                                                freeReportTextEl.innerHTML = formattedText;                        freeReportHookEl.innerHTML = formattedHook;                                                showStep('result');                     } catch (error) {                        console.error("Failed to parse JSON response (Step 3):", error, "Raw text:", rawJsonString);                        resultTitleEl.innerText = "–û–π, —Å—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞";                        freeReportTitleEl.innerHTML = "‚ùå –ü–æ–º–∏–ª–∫–∞ –ê–Ω–∞–ª—ñ–∑—É";                        freeReportTextEl.innerHTML = `<p>–ù–∞ –∂–∞–ª—å, —Å—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å –æ–±—Ä–æ–±–∫–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤—ñ–¥ –®–Ü. –¶–µ –º–æ–≥–ª–æ —Å—Ç–∞—Ç–∏—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.</p><p><i>${rawJsonString}</i></p>`;                        freeReportHookEl.innerHTML = "–ë—É–¥—å –ª–∞—Å–∫–∞, —Å–ø—Ä–æ–±—É–π—Ç–µ –æ–Ω–æ–≤–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É —Ç–∞ –ø–æ—á–∞—Ç–∏ —Å–ø–æ—á–∞—Ç–∫—É.";                                                showStep('result');                    }                }            });            // –ö–†–û–ö 3 -> –ö–†–û–ö 4 (–†–µ–∑—É–ª—å—Ç–∞—Ç -> –ü—Ä–µ–º—ñ—É–º –î–∞–Ω—ñ)            upgradeButton.addEventListener('click', () => {                showStep('premiumData');            });            // === –õ–æ–≥—ñ–∫–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –º—ñ—Å—Ç–∞ ===            async function validateAndGoToPaywall() {                const time = birthTimeInput.value;                const city = birthCityInput.value.trim();                cityErrorMessage.style.display = 'none';                cityInfoMessage.style.display = 'none';                birthCityInput.classList.remove('input-error');                                userBirthData.time = time || '';                if (city === '') {                    userBirthData.city = '';                    userBirthData.geo = null;                    console.log("City field empty, skipping validation.");                                        // NEW: RENDER FINGERPRINT                    renderPlanetaryFingerprint();                                        showStep('paywall');                    return;                }                                setButtonLoading(continueToPaywallButton, true);                const coords = await getCoordinatesFromGemini(city);                                let infoText = null;                  if (coords && coords.latitude) {                    userBirthData.geo = {                            latitude: coords.latitude,                            longitude: coords.longitude,                            timezone: coords.timezone                      };                    userBirthData.city = coords.corrected_name;                    console.log("City validated and saved:", userBirthData.geo);                                        if (city.toLowerCase() !== coords.corrected_name.toLowerCase()) {                        infoText = `–ú–∏ —É—Ç–æ—á–Ω–∏–ª–∏: ${coords.corrected_name} üòâ`;                    }                                        if (infoText) {                        cityInfoMessage.innerText = infoText;                        cityInfoMessage.style.display = 'block';                    }                                        setButtonLoading(continueToPaywallButton, false);                    setTimeout(() => {                        // NEW: RENDER FINGERPRINT                        renderPlanetaryFingerprint();                        showStep('paywall');                    }, infoText ? 1200 : 0);                } else if (coords && coords.error === 'ambiguous') {                    cityErrorMessage.innerText = `–ú—ñ—Å—Ç–æ "${city}" –∑–Ω–∞–π–¥–µ–Ω–æ –≤ –∫—ñ–ª—å–∫–æ—Ö –º—ñ—Å—Ü—è—Ö. –ë—É–¥—å –ª–∞—Å–∫–∞, —É—Ç–æ—á–Ω–∏, –¥–æ–¥–∞–≤—à–∏ –∫—Ä–∞—ó–Ω—É (–Ω–∞–ø—Ä., '–ü–∞—Ä–∏–∂, –§—Ä–∞–Ω—Ü—ñ—è').`;                    cityErrorMessage.style.display = 'block';                    birthCityInput.classList.add('input-error');                    setButtonLoading(continueToPaywallButton, false);                } else {                    cityErrorMessage.innerText = `–ù–µ –º–æ–∂–µ–º–æ –∑–Ω–∞–π—Ç–∏ –º—ñ—Å—Ç–æ "${city}". –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, –±—É–¥—å –ª–∞—Å–∫–∞, –Ω–∞–∑–≤—É.`;                    cityErrorMessage.style.display = 'block';                    birthCityInput.classList.add('input-error');                    setButtonLoading(continueToPaywallButton, false);                }            }                        continueToPaywallButton.addEventListener('click', validateAndGoToPaywall);                        skipButton.addEventListener('click', () => {                userBirthData.time = '';                userBirthData.city = '';                userBirthData.geo = null;                console.log("User skipped premium data.");                                // NEW: RENDER FINGERPRINT                renderPlanetaryFingerprint();                                showStep('paywall');            });            // –ö–†–û–ö 5 -> (–°–∏–º—É–ª—è—Ü—ñ—è –û–ø–ª–∞—Ç–∏)            finalCheckoutButton.addEventListener('click', async () => {                setButtonLoading(finalCheckoutButton, true);                                try {                    sessionStorage.setItem('destinyCodeData', JSON.stringify(userBirthData));                } catch (e) {                    console.error("SessionStorage is unavailable:", e);                }                                console.log("Simulating payment processing... Data saved:", userBirthData);                await new Promise(resolve => setTimeout(resolve, 2500));                                 console.log("Payment simulation successful.");                 setButtonLoading(finalCheckoutButton, false);                 showStep('success');             });            // --- –ö–†–û–ö 7: –ó–ë–Ü–† EMAIL –¢–ê –ì–ï–ù–ï–†–ê–¶–Ü–Ø (–û–ù–û–í–õ–ï–ù–û) ---            emailForm.addEventListener('submit', async (e) => {                e.preventDefault();                const email = userEmailInput.value;                                if (email) {                    console.log("Email captured:", email);                    // 1. –°–∫–∏–¥–∞—î–º–æ –ø—Ä–∞–ø–æ—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó                    isAnimationComplete = false;                    isReportReady = false;                    generatedReportData = null;                                         // 2. –ì–æ—Ç—É—î–º–æ UI –¥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è                    emailCaptureBox.style.display = 'none';                    reportLoadingIndicator.style.display = 'block'; // <- –ü–û–ö–ê–ó–£–Ñ–ú–û –°–ü–Ü–ù–ï–†                                        reportLoadingTextEl.innerHTML = '';                     reportCursorEl.style.display = 'none';                                        // 3. –ó–∞–ø—É—Å–∫–∞—î–º–æ –û–ë–ò–î–í–ê –ø—Ä–æ—Ü–µ—Å–∏ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ                    startReportLoadingAnimation();                    fetchFullAnalysis(userBirthData, email);                }            });            // LTV –ê–ø—Å–µ–ª (–û–ù–û–í–õ–ï–ù–û: –Ü–ú–Ü–¢–ê–¶–Ü–Ø –û–ü–õ–ê–¢–ò + –í–Ü–î–ü–†–ê–í–ö–ê)            ltvUpsellBtn.addEventListener('click', async () => {                const btn = ltvUpsellBtn;                const originalText = btn.querySelector('.btn-text').innerText;                                // 1. –í–º–∏–∫–∞—î–º–æ –ª–æ–∞–¥–µ—Ä –Ω–∞ –∫–Ω–æ–ø—Ü—ñ                btn.classList.add('loading');                btn.disabled = true;                btn.querySelector('.btn-text').innerText = "–û–±—Ä–æ–±–∫–∞ –ø–ª–∞—Ç–µ–∂—É...";                                try {                    console.log("Upsell initiated...");                                        // 2. –Ü–ú–Ü–¢–ê–¶–Ü–Ø –û–ü–õ–ê–¢–ò (2.5 —Å–µ–∫—É–Ω–¥–∏)                    await new Promise(resolve => setTimeout(resolve, 2500));                    console.log("Payment successful.");                    // 3. –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∑–∞–ø–∏—Ç –Ω–∞ –±–µ–∫–µ–Ω–¥ –∑ —Ç–∏–ø–æ–º 'upsell'                    const email = userEmailInput.value; // Email –∑ —Ñ–æ—Ä–º–∏ –≤–∏—â–µ                                        // –ì–µ–Ω–µ—Ä—É—î–º–æ –∫–æ–Ω—Ç–µ–Ω—Ç –ø—Ä–æ–≥–Ω–æ–∑—É                    const forecastHtml = generatedReportData +                         "<br><br><h2 style='color: #cda45e; font-size: 1.5em; margin-top: 2em;'>üîÆ –¢–≤—ñ–π –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 2026 —Ä—ñ–∫</h2>" +                        "<p>–ù–∞—Å—Ç—É–ø–Ω–∏–π —Ä—ñ–∫ —Å—Ç–∞–Ω–µ –¥–ª—è —Ç–µ–±–µ —Ä–æ–∫–æ–º —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ–π. –°–∞—Ç—É—Ä–Ω –≤–∏–º–∞–≥–∞—Ç–∏–º–µ –¥–∏—Å—Ü–∏–ø–ª—ñ–Ω–∏, –∞–ª–µ –Æ–ø—ñ—Ç–µ—Ä –ø–æ–¥–∞—Ä—É—î —É–¥–∞—á—É –≤ –Ω–æ–≤–∏—Ö –ø–æ—á–∏–Ω–∞–Ω–Ω—è—Ö.</p>" +                        "<p>–ë—ñ–ª—å—à–µ –¥–µ—Ç–∞–ª–µ–π —É –ø—Ä–∏–∫—Ä—ñ–ø–ª–µ–Ω–æ–º—É PDF —Ñ–∞–π–ª—ñ.</p>";                                        await fetch(EMAIL_BACKEND_URL, {                        method: 'POST',                        headers: { 'Content-Type': 'application/json' },                        body: JSON.stringify({                            userEmail: email,                            reportHtml: forecastHtml,                            reportType: 'upsell', // <--- –ö–õ–Æ–ß–û–í–ò–ô –ú–û–ú–ï–ù–¢: –ë–µ–∫–µ–Ω–¥ –ø–æ–±–∞—á–∏—Ç—å —Ü–µ —ñ –∑–º—ñ–Ω–∏—Ç—å —Ç–µ–º—É –ª–∏—Å—Ç–∞                            userData: userBirthData // <--- ADDED: Pass user data for Upsell PDF                        })                    });                                        // –£—Å–ø—ñ—Ö UI                    btn.classList.remove('loading');                    btn.querySelector('.btn-text').innerText = "–û–ø–ª–∞—á–µ–Ω–æ! –ü—Ä–æ–≥–Ω–æ–∑ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ ‚úÖ";                                        // –ü–æ–∫–∞–∑—É—î–º–æ –º–æ–¥–∞–ª–∫—É                    showModal(                        "–î—è–∫—É—î–º–æ –∑–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è! üîÆ",                         "–í–∞—à <strong>'–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 2026 —Ä—ñ–∫'</strong> —É—Å–ø—ñ—à–Ω–æ –æ–ø–ª–∞—á–µ–Ω–æ.<br><br>–ú–∏ –≤–∂–µ –≤—ñ–¥–ø—Ä–∞–≤–∏–ª–∏ –π–æ–≥–æ (—Ä–∞–∑–æ–º –∑ PDF-—Ñ–∞–π–ª–æ–º) –æ–∫—Ä–µ–º–∏–º –ª–∏—Å—Ç–æ–º –Ω–∞ –≤–∞—à—É –ø–æ—à—Ç—É."                    );                                    } catch (error) {                    console.error("Upsell failed:", error);                    showModal("–ü–æ–º–∏–ª–∫–∞", "–ù–µ –≤–¥–∞–ª–æ—Å—è –æ–±—Ä–æ–±–∏—Ç–∏ –ø–ª–∞—Ç—ñ–∂ –∞–±–æ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –ª–∏—Å—Ç. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.");                    btn.classList.remove('loading');                    btn.disabled = false;                    btn.querySelector('.btn-text').innerText = originalText;                }            });            // ==========================================            // HELPER: CLEAN HTML FOR PDF (NEW)            // ==========================================            function cleanHtmlForPdf(htmlContent) {                if (!htmlContent) return '';                // Create a temp element to manipulate DOM                const tempDiv = document.createElement('div');                tempDiv.innerHTML = htmlContent;                                // Remove Astro Data Box (because it's already on the Cover Page)                const astroBox = tempDiv.querySelector('.astro-data-box');                if (astroBox) {                    astroBox.remove();                }                                return tempDiv.innerHTML;            }            // –û–±—Ä–æ–±–Ω–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ PDF/Share (–†–ï–ê–õ–¨–ù–Ü)            downloadPdfBtn.addEventListener('click', async () => {                setButtonLoading(downloadPdfBtn, true);                                if (!generatedReportData) {                    showModal("–ü–æ–º–∏–ª–∫–∞", "–î–∞–Ω—ñ –∑–≤—ñ—Ç—É —â–µ –Ω–µ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ.");                    setButtonLoading(downloadPdfBtn, false);                    return;                }                                // === DEBUG ALERT: –í–ò–î–ê–õ–ò–¢–ò –ü–Ü–°–õ–Ø –¢–ï–°–¢–£ ===                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —î –¥–∞–Ω—ñ –ø–µ—Ä–µ–¥ –≤—ñ–¥–ø—Ä–∞–≤–∫–æ—é                const chartStatus = userBirthData.chartSvg ? "‚úÖ –ö–∞—Ä—Ç–∞ –Ñ" : "‚ùå –ö–∞—Ä—Ç–∏ –ù–µ–º–∞—î (Renderer?)";                const planetsStatus = (userBirthData.planets && userBirthData.planets.length > 0)                       ? `‚úÖ –ü–ª–∞–Ω–µ—Ç: ${userBirthData.planets.length}`                       : "‚ùå –ü–ª–∞–Ω–µ—Ç –ù–µ–º–∞—î";                                console.log(`DEBUG Check: ${chartStatus}, ${planetsStatus}`);                // ==========================================                try {                    // üî• –ö–†–û–ö 1: –°—Ç–≤–æ—Ä—é—î–º–æ —Ä–æ–∑—à–∏—Ä–µ–Ω–∏–π HTML                    // !!! FIX v3.29: CLEAN HTML TO REMOVE DUPLICATE PAGE 2                    let enrichedHtml = cleanHtmlForPdf(generatedReportData);                                        // üî• –ö–†–û–ö 2: –ó–±–∏—Ä–∞—î–º–æ CSS —Å—Ç–∏–ª—ñ                    const styles = Array.from(document.styleSheets)                        .map(sheet => {                            try {                                return Array.from(sheet.cssRules)                                    .map(rule => rule.cssText)                                    .join('\n');                            } catch (e) {                                console.warn("Could not read CSS rules from", sheet.href, e.message);                                return '';                            }                        })                        .join('\n');                                        // üî• –ö–†–û–ö 3: –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –Ω–∞ –±–µ–∫–µ–Ω–¥                    console.log("üì§ Requesting PDF from backend...");                    console.log("üìä Data being sent:", {                        hasChartSvg: !!userBirthData.chartSvg,                        chartSvgLength: userBirthData.chartSvg?.length || 0,                        planetsCount: userBirthData.planets?.length || 0,                        htmlLength: enrichedHtml.length                    });                                        const response = await fetch(PDF_BACKEND_URL, {                        method: 'POST',                        headers: { 'Content-Type': 'application/json' },                        body: JSON.stringify({                            reportHtml: enrichedHtml,                            reportStyles: styles,                            userData: userBirthData // ‚úÖ –û–°–¨ –¢–£–¢ –≤—Å—ñ –¥–∞–Ω—ñ (SVG —ñ –ü–ª–∞–Ω–µ—Ç–∏)                        })                    });                                        if (!response.ok) {                        const errorText = await response.text();                        throw new Error(`Backend error: ${response.status} - ${errorText}`);                    }                                        const result = await response.json();                                        if (result.success && result.pdfBase64) {                        // –ö–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ Base64 —É Blob —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ                        const pdfBlob = base64ToBlob(result.pdfBase64, 'application/pdf');                        const url = URL.createObjectURL(pdfBlob);                                                const link = document.createElement('a');                        link.href = url;                        link.download = result.filename || 'DestinyCode_Report.pdf';                        document.body.appendChild(link);                        link.click();                        document.body.removeChild(link);                        URL.revokeObjectURL(url);                                                console.log("‚úÖ PDF downloaded successfully!");                        showModal("–£—Å–ø—ñ—Ö!", "–¢–≤—ñ–π PDF –∑–≤—ñ—Ç —É—Å–ø—ñ—à–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ! üéâ");                    } else {                        throw new Error("Invalid response from server");                    }                } catch (error) {                    console.error("‚ùå PDF Download Error:", error);                    showModal("–ü–æ–º–∏–ª–∫–∞", `–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ PDF: ${error.message}`);                } finally {                    setButtonLoading(downloadPdfBtn, false);                }            });            // ==========================================            // HELPER: Base64 to Blob Converter            // ==========================================            function base64ToBlob(base64, mimeType) {                const byteCharacters = atob(base64);                const byteArrays = [];                                for (let offset = 0; offset < byteCharacters.length; offset += 512) {                    const slice = byteCharacters.slice(offset, offset + 512);                    const byteNumbers = new Array(slice.length);                                        for (let i = 0; i < slice.length; i++) {                        byteNumbers[i] = slice.charCodeAt(i);                    }                                        byteArrays.push(new Uint8Array(byteNumbers));                }                                return new Blob(byteArrays, { type: mimeType });            }            shareReportBtn.addEventListener('click', () => {                  showModal("–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è", "–§—É–Ω–∫—Ü—ñ—è '–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è' —Å–∫–æ—Ä–æ –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∞!<br><br>(–ö–æ–ª–∏ –º–∏ —Ä–µ–∞–ª—ñ–∑—É—î–º–æ –ø–æ—Å—Ç—ñ–π–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ.)");            });                        // --- –û–ë–†–û–ë–ö–ê –ü–û–í–ï–†–ù–ï–ù–ù–Ø ---            async function handlePaymentReturn() {                const urlParams = new URLSearchParams(window.location.search);                                if (urlParams.has('payment') && urlParams.get('payment') === 'success') {                    showStep('paymentSuccessReturn');                                        let savedData;                    try {                        savedData = JSON.parse(sessionStorage.getItem('destinyCodeData'));                        sessionStorage.removeItem('destinyCodeData');                    } catch (e) { console.error("Could not retrieve data from sessionStorage:", e); }                    if (savedData && savedData.date) {                        userBirthData = savedData;                        console.log("Restored user data:", userBirthData);                        await new Promise(resolve => setTimeout(resolve, 1500));                        showStep('success');                    } else {                        console.error("Payment success, but no data found in storage.");                        showModal("–ü–æ–º–∏–ª–∫–∞ —Å–µ—Å—ñ—ó", "–ü–ª–∞—Ç—ñ–∂ –ø—Ä–æ–π—à–æ–≤, –∞–ª–µ –º–∏ –Ω–µ –∑–º–æ–≥–ª–∏ –∑–Ω–∞–π—Ç–∏ –≤–∞—à—ñ –¥–∞–Ω—ñ. –ë—É–¥—å –ª–∞—Å–∫–∞, –ø–æ—á–Ω—ñ—Ç—å —Å–ø–æ—á–∞—Ç–∫—É.");                        showStep('landing');                    }                                        window.history.replaceState({}, document.title, window.location.pathname);                }            }                        // ======================================================            // === NEW FUNCTION: STYLE CHART TO GOLD ===            // ======================================================            function applyGoldThemeToSVG(container) {                if (!container) return;                                const svg = container.querySelector('svg');                if (!svg) return;                // 1. –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–æ–∑–æ—Ä–∏–π —Ñ–æ–Ω                svg.style.backgroundColor = 'transparent';                // 2. –ó–º—ñ–Ω—é—î–º–æ –ª—ñ–Ω—ñ—ó (–∫–æ–ª–æ, –∞—Å–ø–µ–∫—Ç–∏) –Ω–∞ –ó–æ–ª–æ—Ç–æ                const lines = svg.querySelectorAll('line, circle, path');                lines.forEach(line => {                    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —Ü–µ –Ω–µ "—á–æ—Ä–Ω–∏–π" (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π) –∫–æ–ª—ñ—Ä                    const stroke = line.getAttribute('stroke');                    if (!stroke || stroke === '#000000' || stroke === '#000' || stroke === 'black') {                        line.setAttribute('stroke', '#cda45e');                        line.setAttribute('stroke-width', '1.5'); // –†–æ–±–∏–º–æ —Ç—Ä–æ—Ö–∏ —Ç–æ–Ω—à–µ                    }                });                // 3. –ó–º—ñ–Ω—é—î–º–æ –¢–µ–∫—Å—Ç (–ó–Ω–∞–∫–∏ –∑–æ–¥—ñ–∞–∫—É, –ø–ª–∞–Ω–µ—Ç–∏)                const texts = svg.querySelectorAll('text');                texts.forEach(text => {                    text.setAttribute('fill', '#cda45e');                    text.style.fill = '#cda45e';                    text.style.fontFamily = "'Montserrat', sans-serif";                    text.style.fontWeight = '500';                });                                console.log("üé® Chart recolored to Gold Theme.");            }            /** * v2.17: –§—É–Ω–∫—Ü—ñ—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ü–û–í–ù–û–ì–û –∑–≤—ñ—Ç—É  */            async function fetchFullAnalysis(data, email) {                // === FIX v2.24: Ensure Astro Library is INIT before calculation ===                initAstroLibrary();                 // =================================================================                                let userQuery = `–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è: ${data.date}.`;                if (data.time) userQuery += ` –ß–∞—Å: ${data.time}.`;                if (data.city) userQuery += ` –ú—ñ—Å—Ç–æ: ${data.city}.`;                                let astroDataString = "";                let horoscope = null;                 // === –ï–¢–ê–ü 1: –†–û–ó–†–ê–•–£–ù–û–ö –ì–û–†–û–°–ö–û–ü–£ (–ú–ê–¢–ï–ú–ê–¢–ò–ö–ê) ===                // FALLBACK LOGIC: Use Kyiv as default if geo data is missing (user skipped Step 4)                let calculationGeo = data.geo;                if (!calculationGeo) {                    console.log("‚ö†Ô∏è No GEO data provided. Using default (Kyiv) for calculation fallback.");                    calculationGeo = { latitude: 50.45, longitude: 30.52, timezone: "Europe/Kyiv" };                }                if (Horoscope && data.date && calculationGeo) {                      try {                        console.log("üîÆ Starting Horoscope Calculation...");                        const dateParts = data.date.split('-');                        const year = parseInt(dateParts[0]);                        const month = parseInt(dateParts[1]) - 1;                         const dateNum = parseInt(dateParts[2]);                                                let hour = 12, minute = 0;                        if (data.time) {                            const timeParts = data.time.split(':');                            hour = parseInt(timeParts[0]);                            minute = parseInt(timeParts[1]);                        }                                                // !!! –í–ê–ñ–õ–ò–í–û: –Ø–≤–Ω–µ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∏–ø—ñ–≤ –¥–ª—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ                        const origin = new Origin({                            year: year,                             month: month,                             date: dateNum,                            hour: hour,                             minute: minute,                            latitude: parseFloat(calculationGeo.latitude),                             longitude: parseFloat(calculationGeo.longitude),                            timezone: calculationGeo.timezone                        });                                                horoscope = new Horoscope({                            origin: origin, houseSystem: "placidus", zodiac: "tropical"                        });                        console.log("‚úÖ Horoscope calculated successfully.");                    } catch (err) {                        console.error("‚ùå Failed to calculate horoscope (Math Error):", err);                    }                } else {                     console.log("‚ö†Ô∏è Calculating report completely without GEO data (should not happen with fallback).");                }                // === –ï–¢–ê–ü 2: –ì–ï–ù–ï–†–ê–¶–Ü–Ø –°–ü–ò–°–ö–£ –ü–õ–ê–ù–ï–¢ (–ë–ï–ó–ü–ï–ß–ù–ò–ô –ë–õ–û–ö) ===                if (horoscope) {                    try {                        // === UPDATED v2.32: RE-CALCULATE FULL LIST (JUST IN CASE) ===                        // This is a safety measure for the API prompt text, matching the PDF list.                        const planetsList = [];                        const bodies = horoscope.CelestialBodies;                        const fullBodyKeys = ['sun', 'moon', 'mercury', 'venus', 'mars', 'jupiter', 'saturn', 'uranus', 'neptune', 'pluto', 'ascendant', 'midheaven'];                                                fullBodyKeys.forEach(key => {                              let body = bodies[key];                               if (!body && key === 'ascendant') body = horoscope.Ascendant;                              if (!body && key === 'midheaven') body = horoscope.Midheaven;                                                            if (body) {                                  const sign = body.Sign.label;                                  // === UPDATED CALCULATION (Added Seconds) ===                                const fullDegree = body.ChartPosition.Ecliptic.DecimalDegrees % 30;                                const degree = Math.floor(fullDegree);                                const minutesRaw = (fullDegree - degree) * 60;                                const minute = Math.floor(minutesRaw);                                const seconds = Math.round((minutesRaw - minute) * 60);                                                                const label = key.charAt(0).toUpperCase() + key.slice(1);                                planetsList.push(`${label}:${sign} ${degree}¬∞ ${minute}' ${seconds}"`);                              }                        });                                                // üî• FORCE UPDATE for PDF (Redundant safety check)                        if (planetsList.length > 0) {                             userBirthData.planets = planetsList;                             console.log(`‚úÖ PDF Data Verified in fetchFullAnalysis: ${planetsList.length} planets.`);                        }                                                // –§–æ—Ä–º—É—î–º–æ —Ä—è–¥–æ–∫ –¥–ª—è AI                        const precisePlanetsText = planetsList.join('\n');                                                astroDataString = `                        == –¢–µ—Ö–Ω—ñ—á–Ω—ñ –ê—Å—Ç—Ä–æ–ª–æ–≥—ñ—á–Ω—ñ –î–∞–Ω—ñ (–¥–ª—è –∞–Ω–∞–ª—ñ–∑—É) ==                        –í–ê–ñ–õ–ò–í–û: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —Ç–æ—á–Ω—ñ –≥—Ä–∞–¥—É—Å–∏ –¥–ª—è –≥–ª–∏–±–æ–∫–æ—ó —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—ó (–∞—Å–ø–µ–∫—Ç–∏, –∫—Ä–∏—Ç–∏—á–Ω—ñ –≥—Ä–∞–¥—É—Å–∏).                                                [–¢–æ—á–Ω—ñ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏]                        ${precisePlanetsText}                                                [–†–æ–∑–ø–æ–¥—ñ–ª –ø–æ –î–æ–º–∞—Ö]                        * –°–æ–Ω—Ü–µ: ${horoscope.CelestialBodies.sun.House.label} –î—ñ–º                        * –ú—ñ—Å—è—Ü—å: ${horoscope.CelestialBodies.moon.House.label} –î—ñ–º                        * –í–µ–Ω–µ—Ä–∞: ${horoscope.CelestialBodies.venus.House.label} –î—ñ–º                        * –ú–∞—Ä—Å: ${horoscope.CelestialBodies.mars.House.label} –î—ñ–º                        * –ê—Å—Ü–µ–Ω–¥–µ–Ω—Ç: ${horoscope.Ascendant.Sign.label}                        * Midheaven: ${horoscope.Midheaven.Sign.label}                        * –ü—ñ–≤–Ω—ñ—á–Ω–∏–π –í—É–∑–æ–ª: ${horoscope.CelestialBodies.northnode.House.label} –î—ñ–º                                                == –ö—ñ–Ω–µ—Ü—å –¢–µ—Ö–Ω—ñ—á–Ω–∏—Ö –î–∞–Ω–∏—Ö ==                        `;                    } catch (err) {                        console.error("‚ùå Failed to generate planet list/astro string:", err);                    }                }                // === –ï–¢–ê–ü 3: –ú–ê–õ–Æ–í–ê–ù–ù–Ø –ö–ê–†–¢–ò (–†–ò–ó–ò–ö–û–í–ê–ù–ò–ô –ë–õ–û–ö) ===                // –¶–µ–π –±–ª–æ–∫ —ñ–∑–æ–ª—å–æ–≤–∞–Ω–∏–π. –Ø–∫—â–æ –≤—ñ–Ω –≤–ø–∞–¥–µ, —Ä–µ—à—Ç–∞ –¥–∞–Ω–∏—Ö (–ø–ª–∞–Ω–µ—Ç–∏) –≤–∂–µ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ.                // !!! –í–ê–ñ–õ–ò–í–û: –ó–∞–ª–∏—à–∞—î–º–æ —Å–ø—Ä–æ–±—É —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥—É, –∞–ª–µ –≤ try/catch                if (horoscope && Renderer && chartHiddenRender) {                    try {                        console.log("üé® Starting SVG Rendering...");                        chartHiddenRender.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞                                                const renderer = new Renderer(horoscope);                        renderer.render(chartHiddenRender);                                                // === NEW v2.18: APPLY GOLD THEME ===                        applyGoldThemeToSVG(chartHiddenRender);                        // ===================================                                                // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É                        const svgContent = chartHiddenRender.innerHTML;                        if (svgContent && svgContent.length > 100) {                            userBirthData.chartSvg = svgContent;                            console.log("‚úÖ Chart SVG generated successfully (Gold Themed). Length:", svgContent.length);                        } else {                            console.warn("‚ö†Ô∏è Renderer finished but output is empty.");                            userBirthData.chartSvg = null;                        }                    } catch (renderErr) {                        console.error("‚ùå Renderer CRASHED:", renderErr);                        userBirthData.chartSvg = null;                     }                } else {                    if (horoscope && !Renderer) console.warn("‚ö†Ô∏è Renderer not available.");                    if (horoscope && !chartHiddenRender) console.warn("‚ö†Ô∏è Hidden Div missing.");                }                                const finalUserQuery = userQuery + astroDataString;                                const rawJsonString = await callGeminiAPI(apiProUrl, fullTaskPrompt, finalUserQuery);                // --- –î–∏–Ω–∞–º—ñ—á–Ω–∞ –ø–æ–±—É–¥–æ–≤–∞ HTML ---                                let formattedReportHTML = '';                try {                    const reportData = JSON.parse(rawJsonString);                                        if (reportData.error) {                            formattedReportHTML = `<p>${reportData.message || '–°—Ç–∞–ª–∞—Å—è –Ω–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞.'}</p>`;                    } else if (reportData && reportData.sections) {                                                for (const section of reportData.sections) {                                                        // === FIX FOR MAGAZINE LAYOUT ===                            // Convert \n to </p><p> for real paragraphs                            const formattedText = section.analysis_text                                .split('\n')                                .filter(line => line.trim().length > 0)                                .map(line => `<p>${line.trim().replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}</p>`)                                .join('');                                                        const formattedAdvice = section.practical_advice                                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')                                .replace(/\\n/g, '<br>');                            formattedReportHTML += `                                <div class="report-section mb-6">                                    <h2 style="font-size: 1.5rem; font-weight: 700; color: var(--accent-color); margin-top: 1.5rem; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid var(--border-color);">                                        ${section.icon || '‚ú®'} ${section.title}                                    </h2>                                                                        <div class="report-content-text text-left leading-relaxed space-y-4" style="color: var(--secondary-text-color);">                                        ${formattedText}                                    </div>                                                                        <div class="report-advice mt-4">                                        <strong style="color: var(--accent-color);">–ü—Ä–∞–∫—Ç–∏—á–Ω–∞ –ü–æ—Ä–∞–¥–∞:</strong>                                        <p class="mt-2" style="color: var(--primary-text-color); opacity: 0.9;">${formattedAdvice}</p>                                    </div>                                </div>                            `;                        }                    } else {                        throw new Error("Invalid JSON structure from API.");                    }                } catch (error) {                    console.error("Failed to parse AI response (JSON):", error, "Raw string:", rawJsonString);                    formattedReportHTML = `<p>–ù–∞ –∂–∞–ª—å, —Å—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ–±—Ä–æ–±—Ü—ñ JSON-–≤—ñ–¥–ø–æ–≤—ñ–¥—ñ. –¢–µ–∫—Å—Ç –ø–æ–º–∏–ª–∫–∏: ${rawJsonString}</p>`;                }                                // === v2.17: –ù–æ–≤–∞ –ª–æ–≥—ñ–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó ===                                // === UPDATED v2.34: APPEND ASTRO DATA TO BOTTOM OF REPORT (SWAPPED) ===                // –†–∞–Ω—ñ—à–µ –±—É–ª–æ: astroHtml + formattedReportHTML                // –¢–µ–ø–µ—Ä (–∑–∞ –∑–∞–ø–∏—Ç–æ–º): —Å–ø–æ—á–∞—Ç–∫—É —Ç–µ–∫—Å—Ç, –ø–æ—Ç—ñ–º –±–ª–æ–∫ "–ö–æ—Å–º—ñ—á–Ω–∏–π –í—ñ–¥–±–∏—Ç–æ–∫"                const astroHtml = generateAstroDataHTML();                generatedReportData = formattedReportHTML + astroHtml;                 // =========================================================                                console.log("Sync: Report FINISHED.");                isReportReady = true;                                // –í–∏–∫–ª–∏–∫–∞—î–º–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É                showReportIfReady();                                // =======================================                // === –û–ù–û–í–õ–ï–ù–û: –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –∑–≤—ñ—Ç—É –Ω–∞ –†–ï–ê–õ–¨–ù–ò–ô backend ===                try {                    // –û—Ç—Ä–∏–º—É—î–º–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫                    const reportTitleMatch = formattedReportHTML.match(/<h2.*?>(.*?)<\/h2>/i);                    const reportTitle = reportTitleMatch                           ? reportTitleMatch[1].replace(/<.*?>/g, '').trim().replace(/^[^\w]+/, '')                        : '–í–∞—à –∑–≤—ñ—Ç';                    console.log(`Sending report to ${email} via backend (URL: ${EMAIL_BACKEND_URL})...`);                                        const emailResponse = await fetch(EMAIL_BACKEND_URL, {                        method: 'POST',                        headers: { 'Content-Type': 'application/json' },                        body: JSON.stringify({                            userEmail: email,                            reportHtml: formattedReportHTML,                            reportTitle: reportTitle,                            reportType: 'main', // <--- –î–û–î–ê–ù–û: –¢–∏–ø –∑–≤—ñ—Ç—É (–æ—Å–Ω–æ–≤–Ω–∏–π)                            userData: userBirthData // <--- ADDED: Pass user data for Main PDF (including chartSVG)                        })                    });                    if (!emailResponse.ok) {                        const errorResult = await emailResponse.json();                        throw new Error(errorResult.message || 'Backend failed to send email.');                    }                                        const emailResult = await emailResponse.json();                    console.log("Email sent successfully, Message ID:", emailResult.messageId);                } catch (error) {                    console.error("Failed to send email via backend:", error);                    // –ú–∏ –Ω–µ –ø–æ–∫–∞–∑—É—î–º–æ –ø–æ–º–∏–ª–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É, —â–æ–± –Ω–µ –ø—Å—É–≤–∞—Ç–∏ –≤—Ä–∞–∂–µ–Ω–Ω—è, –±–æ –∑–≤—ñ—Ç –Ω–∞ –µ–∫—Ä–∞–Ω—ñ –≤–∂–µ —î.                }                // =======================================================            }                        // --- 7. –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø ---                        // –õ–æ–≥—ñ–∫–∞ –ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞ –î–∞—Ç–∏ - –í–ï–†–°–Ü–Ø –ó DEV.TXT            function updateDatePlaceholder() {                if (birthDateInput.value === '') {                    datePlaceholder.innerText = '–û–±—Ä–∞—Ç–∏ –¥–∞—Ç—É';                    datePlaceholder.style.color = 'var(--secondary-text-color)';                } else {                    const parts = birthDateInput.value.split('-');                    if (parts.length === 3) {                        const formattedDate = `${parts[2]}.${parts[1]}.${parts[0]}`;                        datePlaceholder.innerText = formattedDate;                        datePlaceholder.style.color = 'var(--primary-text-color)';                    } else {                        datePlaceholder.innerText = '–û–±—Ä–∞—Ç–∏ –¥–∞—Ç—É';                        datePlaceholder.style.color = 'var(--secondary-text-color)';                    }                }            }                        birthDateInput.addEventListener('input', updateDatePlaceholder);            birthDateInput.addEventListener('change', updateDatePlaceholder);                        // –í–ï–†–°–Ü–Ø –ó DEV.TXT            function setDefaultDateOnFirstFocus() {                if (birthDateInput.value === '') {                      console.log("Setting default date to 1995-01-01 for convenience.");                    birthDateInput.value = '1995-01-01';                }            }                        birthDateInput.addEventListener('focus', setDefaultDateOnFirstFocus);            birthDateInput.addEventListener('click', setDefaultDateOnFirstFocus);            birthDateInput.addEventListener('touchstart', setDefaultDateOnFirstFocus); // <-- –¶–ï –í–ê–ñ–õ–ò–í–û –î–õ–Ø iOS!                        birthDateInput.addEventListener('blur', updateDatePlaceholder);                        updateDatePlaceholder();                          // –õ–æ–≥—ñ–∫–∞ –ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞ –ß–∞—Å—É            function updateTimePlaceholder() {                if (birthTimeInput.value === '') {                    timePlaceholder.innerText = '–û–±–µ—Ä–∏ —á–∞—Å';                    timePlaceholder.style.color = 'var(--secondary-text-color)';                } else {                    timePlaceholder.innerText = birthTimeInput.value;                    timePlaceholder.style.color = 'var(--primary-text-color)';                }            }            birthTimeInput.addEventListener('input', updateTimePlaceholder);            birthTimeInput.addEventListener('change', updateTimePlaceholder);            updateTimePlaceholder();                         birthCityInput.addEventListener('input', () => {                 cityErrorMessage.style.display = 'none';                 cityInfoMessage.style.display = 'none';                 birthCityInput.classList.remove('input-error');            });            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∑ WayForPay            handlePaymentReturn();        });    </script></body></html>